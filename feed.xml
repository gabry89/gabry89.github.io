<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/">
    <title>Gabriele Tips</title>
    <link href="https://gabriele.tips/feed.xml" rel="self" />
    <link href="https://gabriele.tips" />
    <updated>2024-04-07T11:58:16+02:00</updated>
    <author>
        <name>Gabriele</name>
    </author>
    <id>https://gabriele.tips</id>

    <entry>
        <title>Verificare la vulnerabilità WinRE CVE-2022-41099 con Intune</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/verificare-la-vulnerabilita-winre-cve-2022-41099-con-intune/"/>
        <id>https://gabriele.tips/verificare-la-vulnerabilita-winre-cve-2022-41099-con-intune/</id>

        <updated>2023-08-22T15:20:55+02:00</updated>
            <summary>
                <![CDATA[
                    Recentemente mi sono imbattuto di nuovo in questa vulnerabilità di Windows che ai tempi avevo deliberatamente deciso di ignorare a causa della scarsa documentazione sulla&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                
  <p>
    Recentemente mi sono imbattuto di nuovo in questa vulnerabilità di Windows che ai tempi avevo deliberatamente deciso di ignorare a causa della scarsa documentazione sulla questione.<br>
  </p>

  <p>
    A distanza di qualche mese, la situazione sembra essere più chiara ed è possibile verificare in modo efficiente se il proprio sistema è vulnerabile.
  </p>

  <p>
    Vediamo poi come utilizzare una Custom Compliance Policy di Microsoft Intune per verificare la presenza della vulnerabilità nel nostro ambiente.<br>
  </p>

  <p class="msg msg--info">
    <b>INFO:</b> L'articolo è stato modificato dalla sua pubblicazione originale.<br><br><u>13/09/2023</u>: <br>- Corretto un bug nello script che non comparava correttamente la versione richiesta con la versione rilevata<br>- Corretto il link alla patch per Windows 10<br>- Corretto l'output dello script di patching
  </p>

  <p>
    
  </p>

  <div class="post__toc">
    <h3>Indice</h3>
    <ul>
      <li><a href="#cose-la-vulnerabilita-cve-2022-41099">Cos'è la vulnerabilità CVE-2022-41099</a></li><li><a href="#verificare-manualmente-la-vulnerabilita">Verificare manualmente la vulnerabilità</a></li><li><a href="#introduzione-alle-custom-compliance-policies-con-intune">Introduzione alle Custom Compliance Policies con Intune</a></li><li><a href="#creiamo-la-nostra-policy-di-compliance">Creiamo la nostra Policy di Compliance</a><ul><li><a href="#script-powershell-di-detection">Script PowerShell di detection</a></li><li><a href="#json-di-configurazione">JSON di configurazione</a></li><li><a href="#configuriamo-il-tutto-nella-dashboard">Configuriamo il tutto nella Dashboard</a></li></ul></li><li><a href="#come-applicare-la-patch-per-cve-2022-41099">Come applicare la patch per CVE-2022-41099</a></li><li><a href="#1-click-winre-downloadandamppatch">1-Click WinRE Download&amp;Patch</a></li><li><a href="#per-concludere">Per concludere</a></li>
    </ul>
  </div>
  

    <h2 id="cose-la-vulnerabilita-cve-2022-41099">
      Cos'è la vulnerabilità CVE-2022-41099
    </h2>

  <p>
    La vulnerabilità CVE-2022-41099 di Windows permette ad un attore malevolo in possesso del computer fisico di bypassare la protezione BitLocker e accedere alle informazioni salvate nel disco. La vulnerabilità è sfruttabile solo se il BitLocker è attivo senza un PIN ma solo tramite il TPM, che è la situazione nella stragrande maggioranza dei casi.
  </p>

  <p>
    <strong>Per poter correggere questa vulnerabilità è necessario un intervento manuale</strong>, ovvero l'installazione di una patch nell'ambiente WinRE, la partizione di Recovery.
  </p>

  <p>
    Non mi dilungherò molto, ma vi consiglio caldamente la lettura di questo articolo che spiega molto bene il problema:<br><a href="https://blog.scrt.ch/2023/08/14/cve-2022-41099-analysis-of-a-bitlocker-drive-encryption-bypass/">https://blog.scrt.ch/2023/08/14/cve-2022-41099-analysis-of-a-bitlocker-drive-encryption-bypass/</a>
  </p>

    <h2 id="verificare-manualmente-la-vulnerabilita">
      Verificare manualmente la vulnerabilità
    </h2>

  <p>
    Prendendo sempre spunto dall'articolo indicato sopra, è sufficiente aprire una PowerShell come amministratore ed eseguire questo script:
  </p>
<pre class="line-numbers  language-sql"><code>$BitLocker = Get-WmiObject -Namespace "Root\cimv2\Security\MicrosoftVolumeEncryption" -Class "Win32_EncryptableVolume" -Filter "DriveLetter = '$($env:SystemDrive)'"
if ($BitLocker) {
    if ($BitLocker.GetProtectionStatus().protectionStatus -eq 1) {
        Write-Host "[CVE-2022-41099] BitLocker is enabled."
        $TpmProtectors = $BitLocker.GetKeyProtectors("0").volumekeyprotectorID | Where-Object {
            $KeyProtectorType = $BitLocker.GetKeyProtectorType($_).KeyProtectorType
            ($KeyProtectorType -eq 1) -or ($KeyProtectorType -ge 4 -and $KeyProtectorType -le 6)
        }
        if ($TpmProtectors) {
            Write-Host "[CVE-2022-41099] A TPM-based protector was found."
            $MountDir = Join-Path -Path ([System.IO.Path]::GetTempPath()) -ChildPath "$([Guid]::NewGuid().Guid)_winre"
            Write-Host "[CVE-2022-41099] Create mount directory: $MountDir"
            $null = New-Item -Path $MountDir -ItemType Directory
            Write-Host "[CVE-2022-41099] Mount RE..."
            reagentc.exe /mountre /path $MountDir
            if ($LASTEXITCODE -eq 0) {
                $TargetFile = Join-Path -Path $MountDir -ChildPath "\Windows\System32\bootmenuux.dll"
                Write-Host "[CVE-2022-41099] File to check: $TargetFile"
                $RealNtVersion = [Diagnostics.FileVersionInfo]::GetVersionInfo($TargetFile).ProductVersion
                Write-Host "[CVE-2022-41099] File version: $RealNtVersion"
                $VersionString = "$($RealNtVersion.Split('.')[0]).$($RealNtVersion.Split('.')[1])"
                $FileVersion = $($RealNtVersion.Split('.')[2])
                $FileRevision = $($RealNtVersion.Split('.')[3])
                if ($VersionString -eq "10.0") {
                    $ExpectedRevision = 0
                    switch ($FileVersion) {
                        "10240" { Write-Host "[CVE-2022-41099] Windows 10, version 1507, file revision should be &gt;= 19567."; $ExpectedRevision = 19567 }
                        "14393" { Write-Host "[CVE-2022-41099] Windows 10, version 1607, file revision should be &gt;= 5499."; $ExpectedRevision = 5499 }
                        "17763" { Write-Host "[CVE-2022-41099] Windows 10, version 1809, file revision should be &gt;= 3646."; $ExpectedRevision = 3646 }
                        "19041" { Write-Host "[CVE-2022-41099] Windows 10, version 2004, file revision should be &gt;= 2247."; $ExpectedRevision = 2247 }
                        "22000" { Write-Host "[CVE-2022-41099] Windows 11, version 21H2, file revision should be &gt;= 1215."; $ExpectedRevision = 1215 }
                        "22621" { Write-Host "[CVE-2022-41099] Windows 11, version 22H2, file revision should be &gt;= 815."; $ExpectedRevision = 815 }
                        default { Write-Host "[CVE-2022-41099] Unsupported OS."}
                    }
                    if ($ExpectedRevision -ne 0) {
                        if ($FileRevision -lt $ExpectedRevision) { Write-Host "[CVE-2022-41099] WinRE is vulnerable." -ForegroundColor Red }
                        else { Write-Host "[CVE-2022-41099] WinRE is not vulnerable." -ForegroundColor Green }
                    }
                }
                else { Write-Host "[CVE-2022-41099] Unsupported version: $VersionString" }
                Write-Host "[CVE-2022-41099] Unmount RE..."
                dism.exe /unmount-image /mountDir:$MountDir /discard
            }
            else { Write-Host "[CVE-2022-41099] Failed to mount WinRE." }
            Write-Host "[CVE-2022-41099] Remove mount directory."
            Remove-Item -Path $MountDir
        }
        else { Write-Host "[CVE-2022-41099] No TPM-based protector was found." }
    }
    else { Write-Host "[CVE-2022-41099] BitLocker is not enabled." }
}</code></pre>

  <p>
    Questo script è il metodo più affidabile e "idiot proof" per verificare se il sistema è vulnerabile o meno, con un risultato parlante senza lasciare dubbi.
  </p>

    <figure class="post__image post__image--center">
      <img loading="lazy" src="https://gabriele.tips/media/posts/19/Screenshot-2023-08-22-alle-15.36.24.png" height="110" width="1210" alt="WinRE is vulnerable"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-15.36.24-xs.png 300w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-15.36.24-sm.png 480w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-15.36.24-md.png 768w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-15.36.24-lg.png 1024w">
      <figcaption>WinRE is vulnerable</figcaption>
    </figure>

    <figure class="post__image post__image--center">
      <img loading="lazy" src="https://gabriele.tips/media/posts/19/Screenshot-2023-08-22-alle-15.36.36.png" height="112" width="1204" alt="WinRE is not vulnerable"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-15.36.36-xs.png 300w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-15.36.36-sm.png 480w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-15.36.36-md.png 768w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-15.36.36-lg.png 1024w">
      <figcaption>WinRE is not vulnerable</figcaption>
    </figure>

  <p>
    Nonostante la sua semplicità e chiarezza, questo codice è poco indicato per un check automatico in background, perché i comandi usati sono abbastanza gravosi sulle risorse di sistema e poco indicati per un "health check", che a seconda della configurazione può essere eseguito anche più volte al giorno.
  </p>

  <p>
    Cercando un po' in giro ho scoperto che è possibile eseguire lo stesso controllo senza dover fare il mount della partizione di Recovery, grazie a questo script:<br><a href="https://p0w3rsh3ll.wordpress.com/2023/04/06/patching-cve-2022-41099/" target="_blank">https://p0w3rsh3ll.wordpress.com/2023/04/06/patching-cve-2022-41099/</a>
  </p>

  <p>
    Inizialmente non funzionava sui miei sistemi, ma semplicemente perché lo script è tarato per i sistemi in inglese, mentre l'output di <code>ReAgentC.exe</code> nei sistemi in italiano o in altre lingue è differente. (Thanks, Micro💩...)
  </p>

  <p>
    Ho quindi modificato lo script per identificare la partizione di recovery a prescindere dalla lingua del sistema:
  </p>
<pre class="line-numbers  language-sql"><code>$null,$RELoc = ((& (Get-Command "$($env:systemroot)\system32\ReAgentC.exe") @('/info')) | Where-Object { $_ -match '\\Recovery\\WindowsRE' } ) -split ':'
$RELoc = $RELoc.Trim()
Get-WindowsImageContent -ImagePath "$($RELoc)\winre.wim" -Index 1 |
Where-Object { $_ -match 'Windows\\WinSxS\\amd64_microsoft-windows-bootmenuux_.+_(?&lt;Version&gt;(\d{1,5}\.)+\d{1,5})_.+\\BootMenuUX\.dll'} |
ForEach-Object { ([regex]'Windows\\WinSxS\\amd64_microsoft-windows-bootmenuux_.+_(?&lt;Version&gt;(\d{1,5}\.)+\d{1,5})_.+\\BootMenuUX\.dll').Matches($_) |
Select-Object -Expand Groups | Where-Object Name -eq 'Version' | Select-Object -ExpandProperty Value}| ForEach-Object { try {[version]$_}catch{ 'Failed'}} |
Sort-Object -Descending | Select-Object -First 1 | ForEach-Object ToString</code></pre>

  <p>
    Questo codice però non è così versatile come il precedente, mostra semplicemente la versione del file <code>BootMenuUX.dll</code>, sta poi all'utente finale capire se la patch è necessaria o meno.
  </p>

  <p>
    Sfruttando questo script veloce ho integrato la logica di verifica automatica implementata nello script precedente, ottenendo quindi uno script veloce ma allo stesso tempo "parlante":
  </p>
<pre class="line-numbers  language-sql"><code>$null,$RELoc = ((& (Get-Command "$($env:systemroot)\system32\ReAgentC.exe") @('/info')) | Where-Object { $_ -match '\\Recovery\\WindowsRE' } ) -split ':'
$RELoc = $RELoc.Trim()
$RealNtVersion = (Get-WindowsImageContent -ImagePath "$($RELoc)\winre.wim" -Index 1 |
Where-Object { $_ -match 'Windows\\WinSxS\\amd64_microsoft-windows-bootmenuux_.+_(?&lt;Version&gt;(\d{1,5}\.)+\d{1,5})_.+\\BootMenuUX\.dll'} |
ForEach-Object { ([regex]'Windows\\WinSxS\\amd64_microsoft-windows-bootmenuux_.+_(?&lt;Version&gt;(\d{1,5}\.)+\d{1,5})_.+\\BootMenuUX\.dll').Matches($_) |
Select-Object -Expand Groups | Where-Object Name -eq 'Version' | Select-Object -ExpandProperty Value}| ForEach-Object { try {[version]$_}catch{ 'Failed'}} |
Sort-Object -Descending | Select-Object -First 1 | ForEach-Object ToString)

$VersionString = "$($RealNtVersion.Split('.')[0]).$($RealNtVersion.Split('.')[1])"
                $FileVersion = $($RealNtVersion.Split('.')[2])
                $FileRevision = $($RealNtVersion.Split('.')[3])
                if ($VersionString -eq "10.0") {
                    $ExpectedRevision = 0
                    switch ($FileVersion) {
                        "10240" { Write-Host "[CVE-2022-41099] Windows 10, version 1507, file revision should be &gt;= 19567."; $ExpectedRevision = 19567 }
                        "14393" { Write-Host "[CVE-2022-41099] Windows 10, version 1607, file revision should be &gt;= 5499."; $ExpectedRevision = 5499 }
                        "17763" { Write-Host "[CVE-2022-41099] Windows 10, version 1809, file revision should be &gt;= 3646."; $ExpectedRevision = 3646 }
                        "19041" { Write-Host "[CVE-2022-41099] Windows 10, version 2004, file revision should be &gt;= 2247."; $ExpectedRevision = 2247 }
                        "22000" { Write-Host "[CVE-2022-41099] Windows 11, version 21H2, file revision should be &gt;= 1215."; $ExpectedRevision = 1215 }
                        "22621" { Write-Host "[CVE-2022-41099] Windows 11, version 22H2, file revision should be &gt;= 815."; $ExpectedRevision = 815 }
                        default { Write-Host "[CVE-2022-41099] Unsupported OS."}
                    }
                    if ($ExpectedRevision -ne 0) {
                        if ([int]$FileRevision -lt $ExpectedRevision) { Write-Host "[CVE-2022-41099] WinRE is vulnerable." -ForegroundColor Red }
                        else { Write-Host "[CVE-2022-41099] WinRE is not vulnerable." -ForegroundColor Green }
                    }
                }
</code></pre>

    <figure class="post__image post__image--center">
      <img loading="lazy" src="https://gabriele.tips/media/posts/19/2023-08-22-17_30_14-Window.png" height="54" width="542" alt="WinRE is not vulnerable"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/19/responsive/2023-08-22-17_30_14-Window-xs.png 300w ,https://gabriele.tips/media/posts/19/responsive/2023-08-22-17_30_14-Window-sm.png 480w ,https://gabriele.tips/media/posts/19/responsive/2023-08-22-17_30_14-Window-md.png 768w ,https://gabriele.tips/media/posts/19/responsive/2023-08-22-17_30_14-Window-lg.png 1024w">
      <figcaption>WinRE is not vulnerable</figcaption>
    </figure>

  <p>
    Ora che abbiamo il nostro script di verifica veloce e parlante, possiamo utilizzarlo come base per costruire una policy di verifica compliance in Intune.
  </p>

    <h2 id="introduzione-alle-custom-compliance-policies-con-intune">
      Introduzione alle Custom Compliance Policies con Intune
    </h2>

  <p>
    In Microsoft Intune è possibile creare delle Compliance Policies personalizzate. La policy è composta da due elementi: uno script PowerShell di "detection" che viene eseguito sulla macchina e un JSON per configurare i valori che desideriamo avere nella nostra "compliance".
  </p>

  <p>
    Anche qui non mi dilungo sulla letteratura ma vi lascio la risorsa ufficiale di Microsoft:<br><a href="https://learn.microsoft.com/en-us/mem/intune/protect/compliance-use-custom-settings" target="_blank">https://learn.microsoft.com/en-us/mem/intune/protect/compliance-use-custom-settings</a>
  </p>

  <p>
    E vi lascio anche questo articolo molto chiaro che mi ha aiutato a capire meglio il funzionamento:<br><a href="https://call4cloud.nl/2021/11/the-last-days-of-custom-compliance/" target="_blank">https://call4cloud.nl/2021/11/the-last-days-of-custom-compliance/<br></a>
  </p>

    <h2 id="creiamo-la-nostra-policy-di-compliance">
      Creiamo la nostra Policy di Compliance
    </h2>

    <h3 id="script-powershell-di-detection">
      Script PowerShell di detection
    </h3>

  <p>
    La prima cosa da fare è costruire lo script PowerShell di detection. Prendendo come base lo script "veloce", lo adattiamo per ritornare un JSON come richiesto dalle specifiche di Intune.
  </p>
<pre class="line-numbers  language-sql"><code>$Result = "ERROR"
$null,$RELoc = ((& (Get-Command "$($env:systemroot)\system32\ReAgentC.exe") @('/info')) | Where-Object { $_ -match '\\Recovery\\WindowsRE' } ) -split ':'
$RELoc = $RELoc.Trim()
$RealNtVersion = (Get-WindowsImageContent -ImagePath "$($RELoc)\winre.wim" -Index 1 |
Where-Object { $_ -match 'Windows\\WinSxS\\amd64_microsoft-windows-bootmenuux_.+_(?&lt;Version&gt;(\d{1,5}\.)+\d{1,5})_.+\\BootMenuUX\.dll'} |
ForEach-Object { ([regex]'Windows\\WinSxS\\amd64_microsoft-windows-bootmenuux_.+_(?&lt;Version&gt;(\d{1,5}\.)+\d{1,5})_.+\\BootMenuUX\.dll').Matches($_) |
Select-Object -Expand Groups | Where-Object Name -eq 'Version' | Select-Object -ExpandProperty Value}| ForEach-Object { try {[version]$_}catch{ 'Failed'}} |
Sort-Object -Descending | Select-Object -First 1 | ForEach-Object ToString)
$VersionString = "$($RealNtVersion.Split('.')[0]).$($RealNtVersion.Split('.')[1])"
                $FileVersion = $($RealNtVersion.Split('.')[2])
                $FileRevision = $($RealNtVersion.Split('.')[3])
                if ($VersionString -eq "10.0") {
                    $ExpectedRevision = 0
                    switch ($FileVersion) {
                        "10240" { $MatchVersion = "[CVE-2022-41099] Windows 10, version 1507, file revision should be 19567 or greater"; $ExpectedRevision = 19567 }
                        "14393" { $MatchVersion = "[CVE-2022-41099] Windows 10, version 1607, file revision should be 5499 or greater"; $ExpectedRevision = 5499 }
                        "17763" { $MatchVersion = "[CVE-2022-41099] Windows 10, version 1809, file revision should be 3646 or greater"; $ExpectedRevision = 3646 }
                        "19041" { $MatchVersion = "[CVE-2022-41099] Windows 10, version 2004, file revision should be 2247 or greater"; $ExpectedRevision = 2247 }
                        "22000" { $MatchVersion = "[CVE-2022-41099] Windows 11, version 21H2, file revision should be 1215 or greater"; $ExpectedRevision = 1215 }
                        "22621" { $MatchVersion = "[CVE-2022-41099] Windows 11, version 22H2, file revision should be 815 or greater"; $ExpectedRevision = 815 }
                        default { $MatchVersion = "[CVE-2022-41099] Unsupported OS."}
                    }
                    if ($ExpectedRevision -ne 0) {
                        if ($FileRevision -lt $ExpectedRevision) { $Result = "[CVE-2022-41099] WinRE is vulnerable" }
                        else { $Result = "[CVE-2022-41099] WinRE is not vulnerable" }
                    }
                }
                
$hash = @{Result = $Result; RealNtVersion = $RealNtVersion; MatchVersion = $MatchVersion}
return $hash | ConvertTo-Json -Compress</code></pre>

  <p>
    Nello script ho deciso di passare al JSON più informazioni di quante ne servono veramente. Purtroppo Intune non permette di mostrare i valori passati nella dashboard, quindi non avremo modo di vedere per esempio il valore di <code>$RealNtVersion</code> e <code>$MatchVersion</code>, ma ho deciso comunque di esporli nel JSON perché vengono registrati nei log in locale sulla macchina e potrebbero essere utili per fare diagnostica.
  </p>

    <h3 id="json-di-configurazione">
      JSON di configurazione
    </h3>

  <p>
    A questo punto creiamo il JSON con la logica che ci interessa.
  </p>
<pre class="line-numbers  language-json"><code>{
"Rules":[ 
    { 
        "SettingName":"Result",
        "Operator":"IsEquals",
        "DataType":"String",
        "Operand":"[CVE-2022-41099] WinRE is not vulnerable",
        "MoreInfoUrl":"https://example.com",
        "RemediationStrings":[ 
           { 
              "Language":"en_US",
              "Title":"[CVE-2022-41099] WinRE is vulnerable.",
              "Description": "Contattare il reparto IT per le verifiche."
           },
           { 
            "Language":"it_IT",
            "Title":"[CVE-2022-41099] WinRE is vulnerable.",
            "Description": "Contattare il reparto IT per le verifiche."
           }
        ]
    },
    { 
        "SettingName":"RealNtVersion",
        "Operator":"NotEquals",
        "DataType":"String",
        "Operand":"",
        "MoreInfoUrl":"https://example.com",
        "RemediationStrings":[ 
           { 
              "Language":"en_US",
              "Title":"[CVE-2022-41099] WinRE is vulnerable.",
              "Description": "Contattare il reparto IT per le verifiche."
           },
           { 
            "Language":"it_IT",
            "Title":"[CVE-2022-41099] WinRE is vulnerable.",
            "Description": "Contattare il reparto IT per le verifiche."
           }
        ]
    },
    { 
        "SettingName":"MatchVersion",
        "Operator":"NotEquals",
        "DataType":"String",
        "Operand":"",
        "MoreInfoUrl":"https://example.com",
        "RemediationStrings":[ 
           { 
              "Language":"en_US",
              "Title":"[CVE-2022-41099] WinRE is vulnerable.",
              "Description": "Contattare il reparto IT per le verifiche."
           },
           { 
            "Language":"it_IT",
            "Title":"[CVE-2022-41099] WinRE is vulnerable.",
            "Description": "Contattare il reparto IT per le verifiche."
           }
        ]
    }

 ]
}</code></pre>

  <p>
    I due valori <code>$RealNtVersion</code> e <code>$MatchVersion</code> li facciamo validare sempre a true poiché non ci interessano nella logica di compliance. Il valore importante è <code>$Result</code>.
  </p>

    <h3 id="configuriamo-il-tutto-nella-dashboard">
      Configuriamo il tutto nella Dashboard
    </h3>

  <p>
    Entriamo nella dashboard di Intune e carichiamo il nostro PowerShell andando in<br><b>Devices &gt; Compliance Policies &gt; Scripts </b>e poi <b>Add &gt; Windows 10 and later</b>
  </p>

    <figure class="post__image post__image--center">
      <img loading="lazy" src="https://gabriele.tips/media/posts/19/Screenshot-2023-08-22-alle-16.28.51.png" height="502" width="1166" alt="Compliance policies | Scripts"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.28.51-xs.png 300w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.28.51-sm.png 480w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.28.51-md.png 768w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.28.51-lg.png 1024w">
      <figcaption>Compliance policies | Scripts</figcaption>
    </figure>

  <p>
    Qui diamo un bel nome al nostro script, io l'ho chiamato <em>"WinRE Vulnerability [CVE-2022-41099]"</em>, andiamo avanti e incolliamo lo script PowerShell lasciando le configurazioni come da screen. Al termine salviamo il tutto.
  </p>

    <figure class="post__image post__image--center">
      <img loading="lazy" src="https://gabriele.tips/media/posts/19/Screenshot-2023-08-22-alle-16.29.31.png" height="1044" width="1620" alt="Create custom script"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.29.31-xs.png 300w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.29.31-sm.png 480w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.29.31-md.png 768w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.29.31-lg.png 1024w">
      <figcaption>Create custom script</figcaption>
    </figure>

  <p>
    Una volta caricato lo script di detection, dobbiamo creare la Custom Compliance Policy e per farlo si va in <strong>Devices &gt; Windows &gt; Compliance Policies</strong>, qui selezioniamo <strong>Create Policy &gt; Windows 10 and later</strong>.
  </p>

  <p>
    Diamo un nome alla nostra Compliance Policy (es. <em>"Windows - WinRE not vulnerable"</em>) e proseguiamo selezionando <strong>Custom Compliance</strong>, attiviamo <strong>Require</strong>, selezioniamo il nostro script di detection e carichiamo il JSON creato precedentemente.
  </p>

  <p>
    Se tutto è stato impostato correttamente dovrebbe popolare i settings impostati nel JSON.
  </p>

    <figure class="post__image post__image--center">
      <img loading="lazy" src="https://gabriele.tips/media/posts/19/Screenshot-2023-08-22-alle-16.42.57.png" height="1634" width="1706" alt="Windows | Compliance policies"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.42.57-xs.png 300w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.42.57-sm.png 480w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.42.57-md.png 768w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.42.57-lg.png 1024w">
      <figcaption>Windows | Compliance policies</figcaption>
    </figure>

  <p>
    A questo punto possiamo proseguire come una classica Compliance Policy, assegnando le azioni in caso di non-compliance e gli assignments, che variano in base al tipo di ambiente. Personalmente ho configurato di segnalare immediatamente la non-compliance assegnando la policy a tutti i dispositivi del tenant.
  </p>

  <p>
    Fatto questo... bisogna aspettare!&nbsp;
  </p>

  <p>
    Purtroppo ci vuole circa mezz'oretta prima che una Compliance Policy venga recepita dall'ambiente di Intune e distribuita. Maggiori dettagli li trovate nel link riportato sopra di call4cloud.&nbsp;
  </p>

  <p>
    Una volta che la policy si sarà propagata a dovere, sarà possibile vedere a colpo d'occhio quali sono i sistemi vulnerabili alla CVE-2022-41099 e pianificare l'installazione manuale della patch.
  </p>

    <figure class="post__image post__image--center">
      <img loading="lazy" src="https://gabriele.tips/media/posts/19/Screenshot-2023-08-22-alle-16.49.41.png" height="652" width="2212" alt="Windows - WinRE Not Vulnerable | Device Status"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.49.41-xs.png 300w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.49.41-sm.png 480w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.49.41-md.png 768w ,https://gabriele.tips/media/posts/19/responsive/Screenshot-2023-08-22-alle-16.49.41-lg.png 1024w">
      <figcaption>Windows - WinRE Not Vulnerable | Device Status</figcaption>
    </figure>

    <h2 id="come-applicare-la-patch-per-cve-2022-41099">
      Come applicare la patch per CVE-2022-41099
    </h2>

  <p>
    A marzo 2023 Microsoft ha rilasciato uno script PowerShell per applicare la patch alla partizione WinRE. Qui trovate la pagina di riferimento:<br><a href="https://support.microsoft.com/en-us/topic/kb5025175-updating-the-winre-partition-on-deployed-devices-to-address-security-vulnerabilities-in-cve-2022-41099-ba6621fa-5a9f-48f1-9ca3-e13eb56fb589" target="_blank">https://support.microsoft.com/en-us/topic/kb5025175-updating-the-winre-partition-on-deployed-devices-to-address-security-vulnerabilities-in-cve-2022-41099-ba6621fa-5a9f-48f1-9ca3-e13eb56fb589</a><br>
  </p>

  <p>
    (In realtà due script, ma se avete una versione di Windows più vecchia della 2004 direi che WinRE è l'ultimo dei vostri problemi.)
  </p>

  <p>
    Il problema di questo script è che bisogna prima scaricare il pacchetto di aggiornamento "Safe OS Dynamic Update" corretto e poi eseguire lo script, passando il percorso del pacchetto come parametro.
  </p>

  <p>
    C'è un po' di letteratura in giro in merito all'applicazione della patch, ve li linko per conoscenza.
  </p>

  <p>
    Qui c'è uno dei post più vecchi sulla questione, che poi è stato aggiornato rimandando allo script ufficiale Microsoft:<br><a href="https://www.elevenforum.com/t/important-issue-to-be-aware-of-if-you-use-bitlocker-on-your-os-drive.11818/page-2#post-244851" target="_blank">https://www.elevenforum.com/t/important-issue-to-be-aware-of-if-you-use-bitlocker-on-your-os-drive.11818/page-2#post-244851&nbsp;</a>
  </p>

  <p>
    Qui trovate uno script che fa un po' di tutto (e un po' di troppo anche, imho) ma come lo script Microsoft bisogna predisporre i file nella giusta cartella:<br><a href="https://manima.de/2023/01/modify-winre-patches-drivers-and-cve-2022-41099/">https://manima.de/2023/01/modify-winre-patches-drivers-and-cve-2022-41099/</a>
  </p>

  <p>
    Qui trovate uno script per scaricare i file di aggiornamento per i vari sistemi, ma i link nello script non sono aggiornati alle ultime versioni di Safe OS rilasciate:&nbsp;<br><a href="https://homotechsual.dev/2023/01/17/Download-CVE-2022-41099-Patches/">https://homotechsual.dev/2023/01/17/Download-CVE-2022-41099-Patches/</a>
  </p>

  <p>
    Qui c'è tutto il mega-spiegone di Microsoft in merito all'aggiornamento di WinRE:<br><a href="https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/add-update-to-winre" target="_blank">https://learn.microsoft.com/en-us/windows-hardware/manufacture/desktop/add-update-to-winre</a><br>
  </p>

    <h2 id="1-click-winre-downloadandamppatch">
      1-Click WinRE Download&amp;Patch
    </h2>

  <p>
    Nessuno degli script trovati in giro fa una cosa molto semplice: scaricare l'ultima versione di SafeOS compatibile e installarla.
  </p>

  <p>
    Ho quindi deciso di prendere lo script di Microsoft e "appiccicarci" sopra in modo molto grezzo e rozzo il download automatico della patch basandomi sulla logica dello script di detection usato in precedenza. Ho modificato la parte iniziale dello script di Microsoft per rimuovere la richiesta dei parametri in ingresso e prendere il file scaricato nella tmp.
  </p>

  <p class="msg msg--warning">
    <b>ATTENZIONE:</b> lo script non è stato testato a fondo in ogni casistica, è scritto male e di fretta, potrebbe andare in errore. La logica di patching è immutata dallo script di Microsoft originale ma non mi assumo comunque nessuna responsabilità in caso di fallimento critico.
  </p>

  <p class="msg msg--info">
    <strong>INFO:</strong> Lo script scarica le patch attuali aggiornate al <u>22 agosto 2023</u> ed è compatibile con Windows 10 dalla versione 2004 alla 22h2 e Windows 11 dalla 21h2 alla 22h2.
  </p>

  <p>
    Di seguito lo script:
  </p>
<pre class="line-numbers  language-sql"><code>$null,$RELoc = ((& (Get-Command "$($env:systemroot)\system32\ReAgentC.exe") @('/info')) | Where-Object { $_ -match '\\Recovery\\WindowsRE' } ) -split ':'
$RELoc = $RELoc.Trim()
$RealNtVersion = (Get-WindowsImageContent -ImagePath "$($RELoc)\winre.wim" -Index 1 |
Where-Object { $_ -match 'Windows\\WinSxS\\amd64_microsoft-windows-bootmenuux_.+_(?&lt;Version&gt;(\d{1,5}\.)+\d{1,5})_.+\\BootMenuUX\.dll'} |
ForEach-Object { ([regex]'Windows\\WinSxS\\amd64_microsoft-windows-bootmenuux_.+_(?&lt;Version&gt;(\d{1,5}\.)+\d{1,5})_.+\\BootMenuUX\.dll').Matches($_) |
Select-Object -Expand Groups | Where-Object Name -eq 'Version' | Select-Object -ExpandProperty Value}| ForEach-Object { try {[version]$_}catch{ 'Failed'}} |
Sort-Object -Descending | Select-Object -First 1 | ForEach-Object ToString)

$VersionString = "$($RealNtVersion.Split('.')[0]).$($RealNtVersion.Split('.')[1])"
                $FileVersion = $($RealNtVersion.Split('.')[2])
                if ($VersionString -eq "10.0") {
                    $WebLink = ""
                    switch ($FileVersion) {
                        "19041" { Write-Host "Windows 10, version 2004"; $WebLink = "https://catalog.s.download.windowsupdate.com/c/msdownload/update/software/crup/2023/06/windows10.0-kb5027389-x64_8d1880d95f920fc8a4c2d96ca8d3b44f3e044581.cab" }
                        "22000" { Write-Host "Windows 11, version 21H2"; $WebLink = "https://catalog.s.download.windowsupdate.com/c/msdownload/update/software/crup/2023/06/windows10.0-kb5027572-x64_2540b19f40241a5c7cae4e782e67c17383965125.cab" }
                        "22621" { Write-Host "Windows 11, version 22H2"; $WebLink = "https://catalog.sf.dl.delivery.mp.microsoft.com/filestreamingservice/files/fd6044df-9ac1-4633-a7f7-0964783d317c/public/windows11.0-kb5028495-x64_d16975c555b3b952605ecf2005c3f5cd75243eb6.cab" }
                        default { Write-Host "Unsupported OS."; exit 1}
                    }
                    if ($WebLink -ne "") {
                        # Get the temporary folder path
                        $tempFolder = [System.IO.Path]::GetTempPath()

                        # Full path where the file will be saved
                        $packagePath = Join-Path -Path $tempFolder -ChildPath "winre-patch.cab"

                        # Download the file
                        Invoke-WebRequest -Uri $WebLink -OutFile $packagePath

                        Write-Host "The file has been downloaded to: $packagePath"
                    }
                }


################################################################################################
#
# Copyright (c) Microsoft Corporation.
# Licensed under the MIT License.
#
# THE SOFTWARE IS PROVIDED *AS IS*, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
# SOFTWARE.
#
################################################################################################

$workDir=""

# ------------------------------------
# Help functions
# ------------------------------------
# Log message

function LogMessage([string]$message) {
    $message = "$([DateTime]::Now) - $message"
    Write-Host $message
}

function IsTPMBasedProtector {
    $DriveLetter = $env:SystemDrive
    LogMessage("Checking BitLocker status")
    $BitLocker = Get-WmiObject -Namespace "Root\cimv2\Security\MicrosoftVolumeEncryption" -Class "Win32_EncryptableVolume" -Filter "DriveLetter = '$DriveLetter'"

    if (-not $BitLocker) {
        LogMessage("No BitLocker object")
        return $False
    }

    $protectionEnabled = $False
    switch ($BitLocker.GetProtectionStatus().protectionStatus) {
        ("0") {
            LogMessage("Unprotected")
            break
        }
        ("1") {
            LogMessage("Protected")
            $protectionEnabled = $True
            break
        }
        ("2") {
            LogMessage("Uknown")
            break
        }
        default {
            LogMessage("NoReturn")
            break
        }
    }

    if (!$protectionEnabled) {
        LogMessage("Bitlocker isn’t enabled on the OS")
        return $False
    }

    $ProtectorIds = $BitLocker.GetKeyProtectors("0").volumekeyprotectorID
    $return = $False

    foreach ($ProtectorID in $ProtectorIds) {
        $KeyProtectorType = $BitLocker.GetKeyProtectorType($ProtectorID).KeyProtectorType
        switch($KeyProtectorType) {
            "1" {
                LogMessage("Trusted Platform Module (TPM)")
                $return = $True
                break
            }
            "4" {
                LogMessage("TPM And PIN")
                $return = $True
                break
            }
            "5" {
                LogMessage("TPM And Startup Key")
                $return = $True
                break
            }
            "6" {
                LogMessage("TPM And PIN And Startup Key")
                $return = $True
                break
            }
            default {break}
        } #endSwitch
    } #EndForeach

    if ($return) {
        LogMessage("Has TPM-based protector")
    }
    else {
        LogMessage("Doesn't have TPM-based protector")
    }

    return $return
}

function SetRegistrykeyForSuccess {
    reg add HKLM\SOFTWARE\Microsoft\PushButtonReset /v WinREPathScriptSucceed /d 1 /f
}

function TargetfileVersionExam([string]$mountDir) {
    # Exam target binary
    $targetBinary=$mountDir + "\Windows\System32\bootmenuux.dll"
    LogMessage("TargetFile: " + $targetBinary)
    $realNTVersion = [Diagnostics.FileVersionInfo]::GetVersionInfo($targetBinary).ProductVersion
    $versionString = "$($realNTVersion.Split('.')[0]).$($realNTVersion.Split('.')[1])"
    $fileVersion = $($realNTVersion.Split('.')[2])
    $fileRevision = $($realNTVersion.Split('.')[3])
    LogMessage("Target file version: " + $realNTVersion)
    if (!($versionString -eq "10.0")) {
        LogMessage("Not Windows 10 or later")
        return $False
    }

    $hasUpdated = $False

    #Windows 10, version 1507 10240.19567
    #Windows 10, version 1607 14393.5499
    #Windows 10, version 1809 17763.3646
    #Windows 10, version 2004 1904X.2247
    #Windows 11, version 21H2 22000.1215
    #Windows 11, version 22H2 22621.815
    switch ($fileVersion) {
        "10240" {
            LogMessage("Windows 10, version 1507")
            if ($fileRevision -ge 19567) {
                LogMessage("Windows 10, version 1507 with revision " + $fileRevision + " &gt;= 19567, updates have been applied")
                $hasUpdated = $True
            }
            break
        }
        "14393" {
            LogMessage("Windows 10, version 1607")
            if ($fileRevision -ge 5499) {
                LogMessage("Windows 10, version 1607 with revision " + $fileRevision + " &gt;= 5499, updates have been applied")
                $hasUpdated = $True
            }
            break
        }
        "17763" {
            LogMessage("Windows 10, version 1809")
            if ($fileRevision -ge 3646) {
                LogMessage("Windows 10, version 1809 with revision " + $fileRevision + " &gt;= 3646, updates have been applied")
                $hasUpdated = $True
            }
            break
        }
        "19041" {
            LogMessage("Windows 10, version 2004")
            if ($fileRevision -ge 2247) {
                LogMessage("Windows 10, version 2004 with revision " + $fileRevision + " &gt;= 2247, updates have been applied")
                $hasUpdated = $True
            }
            break
        }
        "22000" {
            LogMessage("Windows 11, version 21H2")
            if ($fileRevision -ge 1215) {
                LogMessage("Windows 11, version 21H2 with revision " + $fileRevision + " &gt;= 1215, updates have been applied")
                $hasUpdated = $True
            }
            break
        }
        "22621" {
            LogMessage("Windows 11, version 22H2")
            if ($fileRevision -ge 815) {
                LogMessage("Windows 11, version 22H2 with revision " + $fileRevision + " &gt;= 815, updates have been applied")
                $hasUpdated = $True
            }
            break
        }
        default {
            LogMessage("Warning: unsupported OS version")
        }
    }

    return $hasUpdated
}

function PatchPackage([string]$mountDir, [string]$packagePath) {
    # Exam target binary
    $hasUpdated =TargetfileVersionExam($mountDir)
    if ($hasUpdated) {
        LogMessage("The update has already been added to WinRE")
        SetRegistrykeyForSuccess
        return $False
    }

    # Add package
    LogMessage("Apply package:" + $packagePath)
    Dism /Add-Package /Image:$mountDir /PackagePath:$packagePath
    if ($LASTEXITCODE -eq 0) {
        LogMessage("Successfully applied the package")
    }
    else {
        LogMessage("Applying the package failed with exit code: " + $LASTEXITCODE)
        return $False
    }

    # Cleanup recovery image
    LogMessage("Cleanup image")
    Dism /image:$mountDir /cleanup-image /StartComponentCleanup /ResetBase
    if ($LASTEXITCODE -eq 0) {
        LogMessage("Cleanup image succeed")
    }
    else {
        LogMessage("Cleanup image failed: " + $LASTEXITCODE)
        return $False
    }

    return $True
}

# ------------------------------------
# Execution starts
# ------------------------------------
# Check breadcrumb

if (Test-Path HKLM:\Software\Microsoft\PushButtonReset) {
    $values = Get-ItemProperty -Path HKLM:\Software\Microsoft\PushButtonReset

    if (!(-not $values)) {
        if (Get-Member -InputObject $values -Name WinREPathScriptSucceed) {
            $value = Get-ItemProperty -Path HKLM:\Software\Microsoft\PushButtonReset -Name WinREPathScriptSucceed

            if ($value.WinREPathScriptSucceed -eq 1) {
                LogMessage("This script was previously run successfully")
                exit 1
            }
        }
    }
}

if ([string]::IsNullorEmpty($workDir)) {
    LogMessage("No input for mount directory")
    LogMessage("Use default path from temporary directory")
    $workDir = [System.IO.Path]::GetTempPath()
}

LogMessage("Working Dir: " + $workDir)
$name = "CA551926-299B-27A55276EC22_Mount"
$mountDir = Join-Path $workDir $name
LogMessage("MountDir: " + $mountdir)

# Delete existing mount directory
if (Test-Path $mountDir) {
    LogMessage("Mount directory: " + $mountDir + " already exists")
    LogMessage("Try to unmount it")
    Dism /unmount-image /mountDir:$mountDir /discard
    if (!($LASTEXITCODE -eq 0)) {
        LogMessage("Warning: unmount failed: " + $LASTEXITCODE)
    }
    LogMessage("Delete existing mount direcotry " + $mountDir)
    Remove-Item $mountDir -Recurse
}

# Create mount directory
LogMessage("Create mount directory " + $mountDir)
New-Item -Path $mountDir -ItemType Directory

# Set ACL for mount directory
LogMessage("Set ACL for mount directory")
icacls $mountDir /inheritance:r
icacls $mountDir /grant:r SYSTEM:"(OI)(CI)(F)"
icacls $mountDir /grant:r *S-1-5-32-544:"(OI)(CI)(F)"

# Mount WinRE
LogMessage("Mount WinRE:")
reagentc /mountre /path $mountdir
if ($LASTEXITCODE -eq 0) {
    # Patch WinRE
    if (PatchPackage -mountDir $mountDir -packagePath $packagePath) {
        $hasUpdated = TargetfileVersionExam($mountDir)
        if ($hasUpdated) {
            LogMessage("After patch, find expected version for target file")
        }
        else {
            LogMessage("Warning: After applying the patch, unexpected version found for the target file")
        }

        LogMessage("Patch succeed, unmount to commit change")
        Dism /unmount-image /mountDir:$mountDir /commit
        if (!($LASTEXITCODE -eq 0)) {
            LogMessage("Unmount failed: " + $LASTEXITCODE)
            exit 1
        }
        else {
            if ($hasUpdated) {
                if (IsTPMBasedProtector) {
                    # Disable WinRE and re-enable it to let new WinRE be trusted by BitLocker
                    LogMessage("Disable WinRE")
                    reagentc /disable
                    LogMessage("Re-enable WinRE")
                    reagentc /enable
                    reagentc /info
                }

                # Leave a breadcrumb indicates the script has succeed
                SetRegistrykeyForSuccess
            }
        }
    }
    else {
        LogMessage("Patch failed or is not applicable, discard unmount")
        Dism /unmount-image /mountDir:$mountDir /discard
        if (!($LASTEXITCODE -eq 0)) {
            LogMessage("Unmount failed: " + $LASTEXITCODE)
            exit 1
        }
    }

}
else {
    LogMessage("Mount failed: " + $LASTEXITCODE)
}

# Cleanup Mount directory in the end
LogMessage("Delete mount direcotry")
Remove-Item $mountDir -Recurse
</code></pre>

    <h2 id="per-concludere">
      Per concludere
    </h2>

  <p>
    Vorrei poter scrivere liberamente cosa ne penso di questa patch, dell'approccio che ha avuto Microsoft e della mirabolante procedura che bisogna seguire per garantire la sicurezza del dispositivo, ma vorrei evitare di scrivere imprecazioni su queste pagine, quindi mi limiterò a sperare che quanto scritto possa essere d'aiuto ad altre persone per mettere in sicurezza i propri sistemi senza dover impazzire troppo.
  </p>

  <p>
    Microsoft, be better please. ❤️
  </p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Forse questa è la volta buona</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/forse-questa-e-la-volta-buona/"/>
        <id>https://gabriele.tips/forse-questa-e-la-volta-buona/</id>

        <updated>2023-08-05T16:37:48+02:00</updated>
            <summary>
                <![CDATA[
                    Questa storia nasce più o meno un anno fa, nell’agosto 2022 quando un po’ curioso e un po’ annoiato decisi di approfondire meglio il mondo&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Questa storia nasce più o meno un anno fa, nell’agosto 2022 quando un po’ curioso e un po’ annoiato decisi di approfondire meglio il mondo dei generatori statici come Hugo, Jekyll e compagnia. </p><h2 id="voglio-solo-uno-spazio-dove-scrivere">Voglio solo uno spazio dove scrivere</h2>
<p>Quando adottai Ghost come strumento per questo blog era ancora una piattaforma dedicata al semplice blogging, ora il CMS si è trasformato in uno strumento per monetizzare contenuti e generare fidelizzazione, implementando tutto uno stack di iscrizioni a pagamento, newsletter, etc. Tutte cose che a me non servono.</p><p>In aggiunta a questo fastidio, la mia istanza ubuntu su cui gira questo macinino è arrivata praticamente a fine vita e avrei dovuto migrare il tutto per la seconda volta. A complicare il tutto, Hetzner ha aumentato il costo a ben 3.82 euro al mese. </p><p>E quindi iniziai guardarmi in giro e vedere un po’ questi strumenti per generare siti statici.</p><p>Una noiosa sera di un noioso agosto del 2022 mi misi a leggere qualche documentazione su Hugo e a cercare qualche tool di migrazione da Ghost a Hugo.</p><h2 id="ghosttohugo">GhostToHugo</h2>
<p>Alla fine tra bestemmie e martellate riuscii a migrare tutto il contenuto e nei giorni successivi feci un po’ di pratica con lo strumento.</p><p>Smaltito l’hype, mi resi conto abbastanza presto delle limitazioni della piattaforma: Hugo è un framework potentissimo ma richiede dedizione per ottenere ciò che si vuole.<br>Out of the box è semplicemente uno strumento che prende dei markdown e genera un sito in html. </p><p>La differenza tra un sito bello e un sito brutto la fa il template che decidi di utilizzare, e anche qui mi si è aperto un mondo (principalmente di bestemmie).<br>Il template non è solo l’aspetto del sito, si porta dietro tutta una serie di funzionalità di generazione della pagina che possono fare la differenza tra un sito con un punteggio PageSpeed di 30 rispetto ad un sito con 100, a parità di contenuto.</p><p>Questa cosa dei template è stata la parte che mi ha fatto più rosicare in assoluto, perché uno dei vantaggi di Ghost è la velocità. Il blog con Ghost è velocissimo, PageSpeed 100, seo friendly, etc. Passare da un tale gioiello ad un sito graficamente non solo meno accattivante, ma anche più lento e meno ottimizzato, mi ha fatto venire una forte avversione verso lo strumento.</p><p>Nonostante ciò riuscii a trovare un template molto carino e ben ottimizzato, con tutto quello che serviva, al netto dell’ottimizzazione delle immagini. Quelle purtroppo andavano “trattate” in formato web-friendly prima di essere caricate, per poter piacere al web.</p><p>Insomma, a parte qualche fastidio, alla fine riuscii ad avere il mio blog, statico, caricato su github a costo zero, pronto per lo switch…</p><p>…ma passò qualche giorno, poi qualche settimana, e alla fine non ne feci più nulla.</p><h2 id="it-works-but">It works, but…</h2>
<p>C’era qualcosa di questo setup che non mi convinceva al 100%. Hugo è potente, lo usano in tantissimi, ma dipendere da un template fatto da terzi per avere un buon ranking della qualità del sito? Passare a mano tutte le immagini con un tool?</p><p>Sì avrei potuto tranquillamente sbattermene le palle, ma c’era qualcosa che non mi convinceva, e alla fine ha prevalso lo status quo per un altro anno intero. Almeno, fino ad oggi.</p><p>Illuminato di nuovo dallo spirito santo della forza di volontà, e un po’ perché mi è ricapitato sotto al naso, ho provato a dare una chance ad uno strumento di publishing un po’ di nicchia: Publii (<a href="https://getpublii.com">https://getpublii.com</a>).</p><h2 id="publii">Publii</h2>
<p>Alcuni considerano Publii un abominio, né carne né pesce, il peggio dei due mondi.
Per me è “match made in heaven” per il mio caso d’uso.</p><p>Facendola breve, Publii è un app, desktop, per generare siti statici. </p><figure class="post__image"><img src="https://gabriele.tips/media/posts/17/publii-cms-2.webp" alt="Publii" width="2502" height="1467"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/17/responsive/publii-cms-2-xs.webp 300w ,https://gabriele.tips/media/posts/17/responsive/publii-cms-2-sm.webp 480w ,https://gabriele.tips/media/posts/17/responsive/publii-cms-2-md.webp 768w ,https://gabriele.tips/media/posts/17/responsive/publii-cms-2-lg.webp 1024w"></figure><p>Mette a disposizione un’interfaccia grafica come i classici CMS web per poter gestire i post e tutte le impostazioni del sito.<br>I contenuti possono essere creati in markdown, con un editor a blocchi o con il classico WYSIWYG. Per ogni post è possibile scegliere l’editor preferito.<br>Un semplice wall of text come questo? Markdown è perfetto.<br>Voglio creare una guida facendo attenzione a curare l’aspetto estetico? Uso il WYSIWYG.<br>Mi piace la merda? Uso l’editor a blocchi.<br>Markdown è veloce ma non offre molta libertà per contenuti più complessi.</p><p>Ma soprattutto, con mia immensa gioia, ho scoperto che Publii ottiene risultati anche migliori di Ghost con il template di default senza che io debba fare nulla:</p><figure class="post__image"><img loading="lazy" src="https://gabriele.tips/media/posts/17/Screenshot-2023-08-05-alle-17.13.07.png" alt="PageSpeed con Publii" width="1908" height="1434"  sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/17/responsive/Screenshot-2023-08-05-alle-17.13.07-xs.png 300w ,https://gabriele.tips/media/posts/17/responsive/Screenshot-2023-08-05-alle-17.13.07-sm.png 480w ,https://gabriele.tips/media/posts/17/responsive/Screenshot-2023-08-05-alle-17.13.07-md.png 768w ,https://gabriele.tips/media/posts/17/responsive/Screenshot-2023-08-05-alle-17.13.07-lg.png 1024w"></figure><h2 id="ghosttopublii">GhostToPublii</h2>
<p>Purtroppo non esistono tool di migrazione da Ghost a Publii, ma quest’ultimo integra un importer per WP. Ho quindi preso l’export di Ghost (in json), convertito nel formato WP tramite un tool online, dato in pasto a Publii e in un attimo ha ricreato tutti i post.</p><p>Ho perso circa un paio d’ore di cazzeggio per rifinire le impostazioni del template per renderlo di mio gradimento e al termine l’ho pubblicato con un clic nel repo di GitHub.</p><p>Infine, mi sono deciso a fare il grande passo e fare definitivamente lo switch.<br>Il dominio principale di questo blog ora punta al sito statico generato da Publii. Il vecchio blog per ora è raggiungibile da <a href="https://old.gabriele.tips">https://old.gabriele.tips</a> se volete fare confronti. Credo lo terrò ancora un paio di mesi, per poi segare definitivamente l’istanza. [EDIT: è offline]</p><p>Se vi interessa ho archiviato qui la versione del blog che avevo creato con Hugo: <a href="https://github.com/gabry89/gabriele-tips-hugo">https://github.com/gabry89/gabriele-tips-hugo</a></p><h2 id="publii-or-not-publii">Publii or not Publii</h2>
<p>Nonostante Publii sia riuscito a convincermi a fare lo switch dedicandogli un paio d’ore della mia vita, mantengo delle riserve sullo strumento.<br>Come accennavo prima, è un po’ una nicchia, non ha un vasto pubblico e lo sviluppo non sembra correre veloce come Hugo o altri framework.<br>E’ comunque attivamente mantenuto e ha la sua piccola comunità.<br>Oggi c’è, funziona e fa quello che mi serve. Domani? Si vedrà.</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Patch CVE-2013-3900 MS13-098 WinVerifyTrust</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/attivare-la-patch-cve-2013-3900-ms13-098-winverifytrust-in-windows-10-e-windows-11/"/>
        <id>https://gabriele.tips/attivare-la-patch-cve-2013-3900-ms13-098-winverifytrust-in-windows-10-e-windows-11/</id>

        <updated>2023-03-31T12:11:09+02:00</updated>
            <summary>
                <![CDATA[
                    Un articolo su una CVE del 2013, nel 2023. Purtroppo è necessario, perché ancora oggi non basta avere i sistemi Windows aggiornati per proteggersi da&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Un articolo su una CVE del 2013, nel 2023. Purtroppo è necessario, perché ancora oggi non basta avere i sistemi Windows aggiornati per proteggersi da questa vulnerabilità, occorre implementare manualmente la correzione per abilitare la patch di sicurezza.</p>
<h2 id="veloce-retrospettiva">Veloce retrospettiva</h2>
<p>Il 10 dicembre 2013 è stata pubblicata la CVE-2013-3900 relativa a una vulnerabilità nella convalida della firma di WinVerifyTrust, che consente agli aggressori di sfruttare il padding di una firma di Windows Authenticode per inserire codice non autorizzato.</p>
<p>La soluzione di Microsoft consisteva nell'offrire una soluzione "opt-in" che poteva essere attivata aggiungendo una coppia di chiavi di registro.</p>
<p>Questa modifica era stata inizialmente pianificata da Microsoft per diventare l'opzione predefinita, ma è stata ufficialmente abbandonata il 29 luglio 2014, probabilmente perché le modifiche causavano problemi nell'installazione di software firmato con Windows Authenticode.</p>
<h2 id="ritorno-al-futuro">Ritorno al futuro</h2>
<p>Dieci anni dopo, i sistemi Windows 10, Windows 11 e Windows Server soffrono della stessa vulnerabilità e, come dieci anni fa, è necessario implementare le chiavi di registro per attivare la patch che è disabilitata “by Design”.</p>
<h2 id="perch%C3%A9-oggi-%C3%A8-un-problema">Perché oggi è un problema</h2>
<p>Senza mezzi termini, questa vulnerabilità è sfruttata quotidianamente dagli attori criminali. Un esempio freschissimo? La violazione supply-chain con il client di 3CX. All’interno del client compromesso è presente una DLL “firmata da Microsoft” che in realtà contiene all’interno una shellcode.</p>
<figure class="kg-card kg-image-card"><a href="https://twitter.com/wdormann/status/1641448760546045954"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/16/Screenshot-2023-03-31-alle-11.33.34.png" sizes="(min-width: 720px) 720px" srcset="https://gabriele.tips/content/images/size/w600/2023/03/Screenshot-2023-03-31-alle-11.33.34.png 600w, https://gabriele.tips/content/images/size/w1000/2023/03/Screenshot-2023-03-31-alle-11.33.34.png 1000w, https://gabriele.tips/media/posts/16/Screenshot-2023-03-31-alle-11.33.34.png 1194w" alt="Screenshot di un tweet di Will Dormann. Clicca per aprire il tweet originale." width="1194" height="1090" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/16/responsive/Screenshot-2023-03-31-alle-11.33.34-xs.png 300w ,https://gabriele.tips/media/posts/16/responsive/Screenshot-2023-03-31-alle-11.33.34-sm.png 480w ,https://gabriele.tips/media/posts/16/responsive/Screenshot-2023-03-31-alle-11.33.34-md.png 768w ,https://gabriele.tips/media/posts/16/responsive/Screenshot-2023-03-31-alle-11.33.34-lg.png 1024w"></figure></a></figure>
<h2 id="cosa-fare">Cosa fare</h2>
<p>Per abilitare la patch è sufficiente aggiungere due chiavi di registro e riavviare.</p>
<!--kg-card-begin: markdown-->
<pre><code>Windows Registry Editor Version</code> 5.00[HKEY_LOCAL_MACHINE\Software\Microsoft\Cryptography\Wintrust\Config]"EnableCertPaddingCheck"="1"[HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Cryptography\Wintrust\Config]"EnableCertPaddingCheck"="1"</pre>
<!--kg-card-end: markdown-->
<p>Qui trovate tutte le info nel dettaglio:</p>
<p><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2013-3900">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2013-3900</a><br><br>A buon rendere!</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Configurare correttamente Microsoft Defender</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/configurare-correttamente-microsoft-defender/"/>
        <id>https://gabriele.tips/configurare-correttamente-microsoft-defender/</id>

        <updated>2022-03-20T15:18:12+01:00</updated>
            <summary>
                <![CDATA[
                    Windows include Microsoft Defender, un software antimalware integrato con il sistema in grado di proteggere il computer dalle minacce più recenti. Negli ultimi anni Microsoft&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Windows include Microsoft Defender, un software antimalware integrato con il sistema in grado di proteggere il computer dalle minacce più recenti.</p>
<p>Negli ultimi anni Microsoft ha fatto enormi investimenti ed evoluzioni per alzare il livello di sicurezza di base di Defender. I primi tentativi lasciavano un po' a desiderare, tuttavia recentemente è arrivato a competere con le soluzioni di protezione più famose e in alcuni casi ne esce persino migliore.</p>
<p>Defender, nella sua configurazione di base, offre una protezione che si potrebbe considerare già sopra la media, tuttavia nasconde delle opzioni che possono essere attivate manualmente per incrementare di molto il livello di protezione e la sicurezza dell'intero sistema.</p>
<p>Alcune di queste opzioni si attivano dalle Impostazioni di Windows, altre invece sono un po' più nascoste e si attivano solamente tramite dei comandi PowerShell.</p>
<p>Fortunatamente, esiste un semplice strumento di terze parti che permette di configurare tutte queste opzioni da una comoda interfaccia.</p>
<!--kg-card-begin: markdown-->
<p class="msg--highlight msg   msg--info">Se si possiede una soluzione di protezione a pagamento con l'abbonamento scaduto, occorre disinstallarla immediatamente. Una protezione in abbonamento senza licenza è totalmente inefficace e vi fornisce una falsa sensazione di sicurezza!</p>
<!--kg-card-end: markdown-->
<h3 id="configure-defender">Configure Defender</h3>
<p>Lo strumento si chiama Configure Defender e lo possiamo scaricare da questo repository GitHub. L'eseguibile da scaricare è "ConfigureDefender.exe".</p>
<p><a href="https://github.com/AndyFul/ConfigureDefender">https://github.com/AndyFul/ConfigureDefender</a></p>
<p>All'apertura veniamo accolti con una serie di pulsanti e selettori, raggruppati per sezioni.</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/15/image-1.png" sizes="(min-width: 720px) 720px" srcset="https://gabriele.tips/content/images/size/w600/2022/03/image-1.png 600w, https://gabriele.tips/media/posts/15/image-1.png 787w" alt="" width="787" height="863" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/15/responsive/image-1-xs.png 300w ,https://gabriele.tips/media/posts/15/responsive/image-1-sm.png 480w ,https://gabriele.tips/media/posts/15/responsive/image-1-md.png 768w ,https://gabriele.tips/media/posts/15/responsive/image-1-lg.png 1024w"></figure>
<figcaption>L'interfaccia principale di ConfigureDefender</figcaption>
</figure>
<p>È possibile andare ad impostare ogni singola voce, oppure usare delle configurazione pre-impostate ottimali.</p>
<p>Nello specifico, l'impostazione che consiglio di attivare è <strong>HIGH</strong>.</p>
<p>L'impostazione HIGH attiva molte delle funzionalità di protezione contro gli exploit, attiva la Network Protection e molte delle regole di riduzione della superficie di attacco (ASR).</p>
<p><strong>Per attivarla è sufficiente cliccare su HIGH, attendere qualche secondo la comparsa della finestra di conferma e riavviare il computer.</strong></p>
<figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/15/image-2.png" alt="" width="372" height="188" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/15/responsive/image-2-xs.png 300w ,https://gabriele.tips/media/posts/15/responsive/image-2-sm.png 480w ,https://gabriele.tips/media/posts/15/responsive/image-2-md.png 768w ,https://gabriele.tips/media/posts/15/responsive/image-2-lg.png 1024w"></figure>
<figcaption>Avviso di conferma di avvenuta configurazione</figcaption>
</figure>
<p><strong>Fatto! In pochi minuti avete appena eseguito un aggiornamento veramente sostanziale a Microsoft Defender e alla sicurezza del vostro computer.</strong></p>
<!--kg-card-begin: markdown-->
<p class="msg--highlight msg ">Questa configurazione funziona solamente se non sono presenti altre soluzioni di protezione antivirus installate nel sistema (es. McAfee, Norton, etc...).</p>
<!--kg-card-end: markdown-->
<p>Ma cosa abbiamo fatto? Se siete curiosi, vediamo un po' nel dettaglio qualche impostazione.</p>
<h3 id="funzionalit%C3%A0-antimalware-attivate-con-limpostazione-high">Funzionalità antimalware attivate con l'impostazione HIGH</h3>
<p><strong>PUA Protection [On]</strong></p>
<p>Le applicazioni potenzialmente indesiderate (PUA) sono una categoria di software che può rallentare il funzionamento del computer, visualizzare annunci indesiderati o, nel peggiore dei casi, installare altro software senza il vostro consenso. Protezione imprescindibile.</p>
<p><em>Approfondimento tecnico: </em></p>
<p><a href="https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/detect-block-potentially-unwanted-apps-microsoft-defender-antivirus?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/detect-block-potentially-unwanted-apps-microsoft-defender-antivirus?view=o365-worldwide</a></p>
<p><strong>Cloud Protection Level [Highest]</strong></p>
<p>La protezione Cloud è la forma di protezione più avanzata presente nei moderni antivirus e antimalware. Usa la potenza di elaborazione del Cloud per determinare se un file è o meno una minaccia. Per farla breve, abbiamo girato la manopola un po' più aggressiva.</p>
<p><em>Approfondimento tecnico:</em></p>
<p><a href="https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/specify-cloud-protection-level-microsoft-defender-antivirus?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/specify-cloud-protection-level-microsoft-defender-antivirus?view=o365-worldwide</a></p>
<p><strong>Cloud Check Time Limit [20s]</strong></p>
<p>Quando Microsoft Defender trova un nuovo file sospetto, può impedire l'esecuzione del file mentre verifica sul servizio Cloud di protezione l'esito della scansione. Questa funzione si chiama BAFS (Block At First Sight).</p>
<p>Il periodo predefinito per il blocco del file è di 10 secondi, con questa impostazione l'abbiamo portato ad un massimo 20 secondi.</p>
<p>Terminati i 20 secondi, se Defender non ha ancora ricevuto una risposta, il file verrà sbloccato ed eseguito, ma la scansione continuerà comunque nel Cloud fino alla ricezione del risultato. Se dovesse risultare malevolo dopo i 20 secondi, il file verrà inserito in quarantena.</p>
<p>Nella maggior parte dei casi, il risultato della scansione Cloud avviene ben prima dei 20 secondi.</p>
<p><em>Approfondimento tecnico:</em></p>
<p><a href="https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-cloud-block-timeout-period-microsoft-defender-antivirus?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/configure-cloud-block-timeout-period-microsoft-defender-antivirus?view=o365-worldwide</a></p>
<p><strong>EXPLOIT GUARD Attack Surface Reduction (ASR)</strong></p>
<p>Nella sezione EXPLOIT GUARD di Configure Defender vengono riportate tutte le impostazioni attivate per la riduzione della superficie di attacco.</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/15/image-3.png" sizes="(min-width: 720px) 720px" srcset="https://gabriele.tips/content/images/size/w600/2022/03/image-3.png 600w, https://gabriele.tips/media/posts/15/image-3.png 787w" alt="" width="787" height="861" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/15/responsive/image-3-xs.png 300w ,https://gabriele.tips/media/posts/15/responsive/image-3-sm.png 480w ,https://gabriele.tips/media/posts/15/responsive/image-3-md.png 768w ,https://gabriele.tips/media/posts/15/responsive/image-3-lg.png 1024w"></figure>
<figcaption>Sezione relativa alle regole ASR</figcaption>
</figure>
<p>Queste funzionalità di riduzione della superficie di attacco sono l'introduzione più interessante fatta da Microsoft negli ultimi anni. Le regole ASR mirano a chiudere o disattivare funzionalità di sistema pericolose che non vengono quasi mai usate dagli utenti, ma vengono spesso abusate dai malware per eseguire comandi malevoli e ottenere l'accesso al computer.</p>
<p>Per dirla breve, mette le sbarre a quella finestra che non usate mai e non sapete di avere, ma che fa tanto gola ai ladri.</p>
<p>Le regole ASR sono numerose e la loro spiegazione nel dettaglio può risultare complessa per chi non è molto pratico. Oltretutto, l'attivazione di una regola ASR può comportare dei falsi positivi, ovvero il blocco del funzionamento di una applicazione benigna.</p>
<p>La configurazione a HIGH attiva solamente le regole ASR che nel 99% dei casi non causano problemi nell'uso quotidiano, ma bloccano la stragrande maggioranza delle funzionalità di Windows usate dai malware. Per fare qualche esempio:</p>
<ul>
<li>impedisce alle macro di Office di fare chiamate di sistema pericolose</li>
<li>impedisce agli scripts di lanciare eseguibili scaricati da internet</li>
<li>impedisce l'esecuzione di scripts offuscati, spesso nascosti negli allegati e-mail</li>
<li>blocca l'esecuzione di processi non firmati da chiavette USB</li>
</ul>
<p>La lista delle regole ASR è in costante aumento e verranno introdotte molte altre regole nel prossimo futuro.</p>
<p><em>Approfondimento tecnico:</em></p>
<p><a href="https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide">https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/attack-surface-reduction-rules-reference?view=o365-worldwide</a></p>
<p><em>Se volete leggere l'esperienza di un team tecnico che ha implementato le ASR in ambiente business corporate:</em></p>
<p><a href="https://blog.palantir.com/microsoft-defender-attack-surface-reduction-recommendations-a5c7d41c3cf8">https://blog.palantir.com/microsoft-defender-attack-surface-reduction-recommendations-a5c7d41c3cf8</a></p>
<p><strong>Network Protection [ON]</strong></p>
<p>La Network Protection è abbastanza parlante e il suo funzionamento è molto semplice: impedisce di accedere a domini e IP pericolosi come phishing, scam e siti che ospitano malware.</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/15/image-4.png" alt="" width="567" height="418" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/15/responsive/image-4-xs.png 300w ,https://gabriele.tips/media/posts/15/responsive/image-4-sm.png 480w ,https://gabriele.tips/media/posts/15/responsive/image-4-md.png 768w ,https://gabriele.tips/media/posts/15/responsive/image-4-lg.png 1024w"></figure>
<figcaption>Notifica di blocco</figcaption>
</figure>
<h3 id="altre-impostazioni-avanzate-per-esperti">Altre impostazioni avanzate per esperti</h3>
<p>Come avrete notato, Microsoft Defender presenta molte altre funzioni che la configurazione HIGH non ha attivato. Sono funzioni avanzate, che possono generare falsi positivi se non vengono gestite correttamente.</p>
<p>Consiglio di approfondire il funzionamento solo se si è consapevoli e se sapete fare una ricerca tecnica su Google.</p>
<p>Per esempio la funzione di Controlled Folder Access permette di impedire ai ransomware di cifrare le cartelle dei documenti, ma la protezione è estremamente severa e il rischio di bloccare l'accesso ad applicazioni sicure è molto frequente. Attivatela solo se siete disposti a voler gestire qualche falso positivo da aggiungere alle esclusioni.</p>
<p>Volendo è possibile impostare Defender in modalità "paranoia", bloccando tutti gli eseguibili che non hanno raggiunto un certo livello di prevalenza, età o non vengano aggiunti ad una lista sicura da parte di Microsoft.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/15/image-5.png" sizes="(min-width: 720px) 720px" srcset="https://gabriele.tips/content/images/size/w600/2022/03/image-5.png 600w, https://gabriele.tips/media/posts/15/image-5.png 721w" alt="" width="721" height="94" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/15/responsive/image-5-xs.png 300w ,https://gabriele.tips/media/posts/15/responsive/image-5-sm.png 480w ,https://gabriele.tips/media/posts/15/responsive/image-5-md.png 768w ,https://gabriele.tips/media/posts/15/responsive/image-5-lg.png 1024w"></figure></figure>
<p>È una funzionalità estremamente utile per i computer che necessitano di un livello di protezione senza compromessi, ma il rischio di vedersi bloccato qualche aggiornamento di un software che usate solo voi e pochi altri è estremamente elevato.</p>
<h3 id="testare-il-corretto-funzionamento">Testare il corretto funzionamento</h3>
<p>La configurazione proposta è pensata per un uso massivo comune e non dovrebbe causare falsi positivi nell'uso quotidiano. Nello specifico, l'unica parte che potrebbe causare qualche falso positivo in qualche caso specifico sono le regole ASR, ma mi vengono in mente solo scenari aziendali con software particolari tipo gestionali balordi mal progettati o macro incredibilmente complesse che operano ad un livello molto integrato con il sistema.</p>
<p>Per un uso domestico o piccolo ufficio, questa configurazione garantisce un aumento considerevole della sicurezza con un rischio pressoché nullo di falsi positivi.</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Furto dati ho. Mobile – Cosa rischio? Cosa fare?</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/furto-dati-ho-mobile-cosa-rischio-cosa-fare/"/>
        <id>https://gabriele.tips/furto-dati-ho-mobile-cosa-rischio-cosa-fare/</id>

        <updated>2021-01-04T15:18:04+01:00</updated>
            <summary>
                <![CDATA[
                    Probabilmente ne avrete sentito parlare, il 28 dicembre un utente anonimo su un forum del dark web affermava di aver violato l’operatore virtuale di Vodafone,&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Probabilmente ne avrete sentito parlare, il 28 dicembre un utente anonimo su un forum del dark web affermava di aver violato l’operatore virtuale di Vodafone, “ho. Mobile”, rubando una notevole quantità di dati personali tra nome, cognome, numero di telefono, codice fiscale, e-mail, data e luogo di nascita, nazionalità e indirizzo e ultimo, ma non meno importante, il codice ICCID della SIM per effettuare la portabilità del numero ad un altro operatore.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/14/image.png" alt="" width="592" height="566" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/14/responsive/image-xs.png 300w ,https://gabriele.tips/media/posts/14/responsive/image-sm.png 480w ,https://gabriele.tips/media/posts/14/responsive/image-md.png 768w ,https://gabriele.tips/media/posts/14/responsive/image-lg.png 1024w"></figure></figure>
<p>Dopo le prime smentite da parte dell’operatore, oggi è arrivata la conferma della violazione con un comunicato ufficiale che trovate a questa pagina: <a href="https://sendy.logotel.it/l/K64763I7GOqtsi7Z892fEC2xUQ/hFNWHsGh2r56vc8wtvPXfg/ctbpaBfqUDNAywODAY9cTg">https://www.ho-mobile.it/comunicazione/</a></p>
<p><strong>Sono utente di "ho. Mobile", mi devo preoccupare? Cosa rischio? 📱</strong></p>
<p>I dati che sono stati rubati sono una lista piuttosto dettagliata di informazioni personali, quindi i criminali ora hanno nome, cognome, indirizzo fisico, indirizzo mail, numero di telefono e codice fiscale di due milioni e mezzo di italiani. Questi dati possono essere utilizzati in futuro per attacchi di phishing mirati e furti di identità.</p>
<p><strong>Devo fare qualcosa per proteggermi? 🛡</strong></p>
<p>È importante prepararsi ad un possibile aumento ti attacchi costruiti sulla base dei dati personali rubati. Non fidatevi di SMS o di mail dove vi viene chiesto di reinserire le credenziali per l’accesso ai vostri account bancari, o di inserire il numero della carta di credito per sbloccare un pagamento. Nel dubbio, fate sempre una verifica chiamando la banca o il servizio da cui avete ricevuto il messaggio per informarli della comunicazione ricevuta e verificarne l'autenticità. Reperite sempre i numeri di telefono e gli indirizzi mail dai siti ufficiali.</p>
<p><strong>Non ho ancora ricevuto la comunicazione diretta da parte di "ho. Mobile". L’ho scampata? 🖖</strong></p>
<p>No. Secondo le prime verifiche ufficiose, il database comprende circa due milioni e mezzo di utenti e sembrerebbe coinvolgere l’intera base di clienti di "ho. Mobile". Il comunicato ufficiale è stato rilasciato solamente questa mattina e la comunicazione ai diretti interessati sta iniziando ad arrivare proprio in queste ore tramite SMS.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/14/1609767079.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/14/responsive/1609767079-xs.png 300w ,https://gabriele.tips/media/posts/14/responsive/1609767079-sm.png 480w ,https://gabriele.tips/media/posts/14/responsive/1609767079-md.png 768w ,https://gabriele.tips/media/posts/14/responsive/1609767079-lg.png 1024w"></figure></figure>
<p><strong>Ho letto che possono rubarmi il conto in banca, è vero? 💸</strong></p>
<p>Estremamente improbabile, ma non impossibile.</p>
<p>Tra i dati rubati c’era anche un numero, chiamato ICCID. Questo numero è una specie di seriale univoco della SIM e con quello è possibile effettuare la migrazione del proprio numero di telefono ad un nuovo operatore. Questo numero in mano a malintenzionati apre le porte ad un attacco molto pericoloso: il SIM swapping. Questa tecnica fraudolenta permette ad un malintenzionato di richiedere la portabilità verso un altro operatore con lo scopo di dirottare gli SMS, usati oggi per l’autenticazione a due fattori di molte banche, verso una nuova SIM di sua proprietà.</p>
<p>Perché è improbabile che accada a noi a causa di questo breach? Perché questo tipo di attacco non può essere scalato velocemente su due milioni e mezzo di utenti, come potrebbe esserlo un furto di account di mail. Richiede l’intervento di un provider telefonico compiacente che effettua la portabilità senza verifica di un documento d’identità. È una tipologia di attacco mirato nei nostri confronti. Insomma, qualcuno che ha pescato da un mazzo di due milioni di carte, proprio la nostra.</p>
<p><strong>Per quanto riguarda la protezione da SIM swapping, posso fare qualcosa? 📴</strong></p>
<p>Per arginare questa pratica illecita la soluzione più facile è quella di richiedere la sostituzione della SIM presso i punti vendita "ho. Mobile" autorizzati. <a href="https://sendy.logotel.it/l/K64763I7GOqtsi7Z892fEC2xUQ/kUMXOcASt1oDsw8FbacaDw/ctbpaBfqUDNAywODAY9cTg">https://www.ho-mobile.it/trova-negozio.html</a></p>
<p><strong>Non mi fido più di "ho. Mobile". Posso cambiare operatore? 📶</strong></p>
<p>Sì, ma farlo ora è sconsigliato perché la procedura potrebbe non andare a buon fine. Stanno arrivando segnalazioni di utenti che stanno ricevendo esito negativo della loro richiesta di portabilità. È probabile che "ho. Mobile" abbia temporaneamente bloccato le portabilità verso altro operatore per arginare il problema del SIM swapping. Se non vi sentite sicuri, vi consiglio temporaneamente di cambiare SIM e quando la situazione si sarà calmata, procedere al cambio di operatore.</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Assistenza Rapida con Windows 10</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/assistenza-rapida-con-windows-10/"/>
        <id>https://gabriele.tips/assistenza-rapida-con-windows-10/</id>

        <updated>2020-05-02T00:47:12+02:00</updated>
            <summary>
                <![CDATA[
                    Windows 10 integra di base un comodo strumento per poter offrire assistenza remota, senza dover scaricare software di terze parti come i più famosi TeamViewer&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Windows 10 integra di base un comodo strumento per poter offrire assistenza remota, senza dover scaricare software di terze parti come i più famosi TeamViewer o AnyDesk.</p>
<p>Il software in questione si chiama proprio <strong>Assistenza Rapida</strong>, ed è facilmente raggiungibile dal menu <strong>Start</strong>  nella cartella <strong>Accessori Windows</strong> e cliccando su <strong>Assistenza rapida</strong>, oppure cliccando il pulsante <strong>Start</strong> e digitando <strong>Assistenza rapida</strong> nella casella di ricerca.</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/13/immagine-1.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/13/responsive/immagine-1-xs.png 300w ,https://gabriele.tips/media/posts/13/responsive/immagine-1-sm.png 480w ,https://gabriele.tips/media/posts/13/responsive/immagine-1-md.png 768w ,https://gabriele.tips/media/posts/13/responsive/immagine-1-lg.png 1024w"></figure>
<figcaption>Assistenza Rapida nel menu Start</figcaption>
</figure>
<h3 id="come-funziona">Come funziona?</h3>
<p>Lo strumento è estremamente semplice: chi offre assistenza clicca su <strong>Aiuta un'altra persona</strong>, generando così un codice da inviare alla persona da aiutare. Questa persona inserisce il codice nel campo <strong>Codice dall'assistente</strong> e nel giro di pochi clic è possibile vedere il PC remoto o prenderne il controllo, a seconda dei permessi concessi.</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/13/immagine-2.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/13/responsive/immagine-2-xs.png 300w ,https://gabriele.tips/media/posts/13/responsive/immagine-2-sm.png 480w ,https://gabriele.tips/media/posts/13/responsive/immagine-2-md.png 768w ,https://gabriele.tips/media/posts/13/responsive/immagine-2-lg.png 1024w"></figure>
<figcaption>Finestra di Assistenza Rapida</figcaption>
</figure>
<p>Personalmente l'ho utilizzato in diverse occasioni e l'ho trovato molto pratico, soprattutto per abbattere i tempi morti iniziali, spesso causati dal dover spiegare a persone non tecnicamente brillanti come scaricare correttamente il software di assistenza da internet.</p>
<p>Quante volte hanno "aperto Google" e alla fine non era Google?</p>
<p>Ecco, ci siamo capiti.</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Privacy Policy</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/privacy-policy/"/>
        <id>https://gabriele.tips/privacy-policy/</id>

        <updated>2020-03-01T23:19:52+01:00</updated>
            <summary>
                <![CDATA[
                    Qui non ci sono tracker, annunci e cookie di nessun genere. Il sito è generato con Publii e ospitato su GitHub Pages. Utilizzo Umami per&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Qui non ci sono tracker, annunci e cookie di nessun genere.</p>
<p>Il sito è generato con <a href="https://getpublii.com" target="_blank" rel="noopener noreferrer">Publii</a> e ospitato su GitHub Pages. Utilizzo <a href="https://umami.is" target="_blank" rel="noopener noreferrer">Umami</a> per avere qualche numero indicativo delle visite sul sito.</p>
<p>Se consideri uno di questi strumenti una violazione della tua privacy, premi <code>Ctrl + W</code> (con Mac <code>Command + W</code>) per caricare una versione alternativa del sito.</p>
<p>Buona lettura!</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Nuova casa per il blog</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/nuova-casa-per-il-blog/"/>
        <id>https://gabriele.tips/nuova-casa-per-il-blog/</id>

        <updated>2020-02-23T15:22:51+01:00</updated>
            <summary>
                <![CDATA[
                    In una sera di noia, ho trasferito questo blog e il dominio su una nuova infrastruttura per ottimizzare la gestione e i costi. Come avevo&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>In una sera di noia, ho trasferito questo blog e il dominio su una nuova infrastruttura per ottimizzare la gestione e i costi.</p>
<p>Come avevo scritto tempo fa, la macchina che ospitava il blog era una piccola EC2 t2.micro su AWS, mentre il dominio era registrato su Route 53.</p>
<p>Ben presto mi sono reso conto che AWS non è per nulla economico e i costi sono anche imprevendibili, perché ogni risorsa viene calcolata in modo preciso in base all'uso. Se si ha tanto traffico, si paga di più perché le risorse computazionali e di data transfer sono superiori. A questi livelli il delta è di un paio di euro al massimo, ma è comunque fastidioso per uno spazio di cazzeggio personale.</p>
<p>Con il setup su AWS, questo blog mi costava circa 14€ al mese, sommando EC2, transfer e zona DNS di Route53.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/11/2020-02-23-14_49_48-Billing-Management-Console.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/11/responsive/2020-02-23-14_49_48-Billing-Management-Console-xs.png 300w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-14_49_48-Billing-Management-Console-sm.png 480w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-14_49_48-Billing-Management-Console-md.png 768w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-14_49_48-Billing-Management-Console-lg.png 1024w"></figure></figure>
<p>Ho mantenuto questa situazione per tanto tempo, a causa della mia inestimabile pigrizia. Il mio obiettivo principale era quello di migrare Ghost ad un CMS statico, ma dopo mesi di ricerca non sono ancora riuscito a trovare un setup pratico che mi abbia convinto ad abbandonare Ghost.</p>
<p>Preso in un momento di buona produttività, ho abbandonato temporaneamente l'idea di staticizzare il blog e mi sono messo d'impegno almeno per migrarlo ad un servizio più economico: ho creato su <a href="https://www.hetzner.com/cloud">Hetzner</a> un VPS, in pochi minuti ho tirato su un Ghost pulito, import del backup in JSON dal vecchio blog, import della cartella dei media, cambio dei DNS e in poco più di un'oretta avevo il blog up &amp; running su una nuova macchina, il cui costo è di 3.65€ al mese.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/11/2020-02-23-14_51_51-Microsoft-Store.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/11/responsive/2020-02-23-14_51_51-Microsoft-Store-xs.png 300w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-14_51_51-Microsoft-Store-sm.png 480w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-14_51_51-Microsoft-Store-md.png 768w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-14_51_51-Microsoft-Store-lg.png 1024w"></figure></figure>
<p>Il passaggio successivo è stata la migrazione del dominio, per smettere di pagare 0.50$ al mese di zona DNS di Route53.</p>
<p>Avendo un TLD poco comune, sono andato su <a href="https://tld-list.com">tld-list.com</a> e ho ordinato per transfer e renew più economici.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/11/2020-02-23-15_01_31-Cheapest-.tips-Domain-Registration--Renewal--Transfer-Prices-_-TLD-List.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/11/responsive/2020-02-23-15_01_31-Cheapest-.tips-Domain-Registration--Renewal--Transfer-Prices-_-TLD-List-xs.png 300w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-15_01_31-Cheapest-.tips-Domain-Registration--Renewal--Transfer-Prices-_-TLD-List-sm.png 480w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-15_01_31-Cheapest-.tips-Domain-Registration--Renewal--Transfer-Prices-_-TLD-List-md.png 768w ,https://gabriele.tips/media/posts/11/responsive/2020-02-23-15_01_31-Cheapest-.tips-Domain-Registration--Renewal--Transfer-Prices-_-TLD-List-lg.png 1024w"></figure></figure>
<p>Detto fatto, anche qui in meno di mezz'ora ho effettuato il transfer del dominio da Route53 a Porkbun 🐷. (tra l'altro è davvero figo porkbun, esperienza ottima!)</p>
<p>Al termine, ho eliminato tutti i servizi attivi su AWS. 👋🏻</p>
<p>Next step: staticizzare il blog e azzerare i costi, ma per quello vedremo più avanti...</p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Fastweb FTTH e Modem Libero</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/fastweb-e-modem-libero/"/>
        <id>https://gabriele.tips/fastweb-e-modem-libero/</id>

        <updated>2019-04-03T23:02:50+02:00</updated>
            <summary>
                <![CDATA[
                    AGGIORNAMENTO del 01/03/2020 Questo articolo è stato scritto diversi mesi fa. Potrebbe non essere più attuale e potrebbe consigliare procedure non più attuabili con i&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p><strong>AGGIORNAMENTO del 01/03/2020</strong></p>
<p>Questo articolo è stato scritto diversi mesi fa. Potrebbe non essere più attuale e potrebbe consigliare procedure non più attuabili con i nuovi router e le nuove attivazioni Fastweb.</p>
<p><strong>ARTICOLO ORIGINALE</strong></p>
<p>Con l’entrata in vigore della delibera AGCOM n. 348/18/CONS sul modem libero, gli operatori di rete fissa sono stati obbligati a rilasciare tutti i parametri relativi alla corretta configurazione di un modem alternativo a quello fornito dall'operatore.</p>
<p>Purtroppo la realtà dei fatti è che non tutti gli operatori hanno risposto in modo efficiente. Tra questi c'è Fastweb che ha interpretato "a modo suo" la delibera, soprattutto in ambito FTTH.</p>
<p>Se andiamo a leggere nella <a href="https://www.fastweb.it/adsl-fibra-ottica/dettagli/altri-modem/">pagina dedicata alla delibera</a> sul sito di Fastweb, si legge:</p>
<p class="msg msg--info">Nel caso di <strong>Fibra</strong>, l'apparato scelto dal cliente alternativo al FASTGate deve essere collegato alla terminazione ottica (ONT) fornita da Fastweb mediante un cavo di rete Ethernet Categoria 5e o superiore alla porta WAN Ethernet.</p>
<p>Insomma, non proprio chiarissimo. Ma soprattutto, se oggi prendete il vostro bel cavo in fibra ottica, prendete il vostro <s>modem</s> router e lo collegate al posto del FASTGate fornito da Fastweb, usando solo le informazioni riportate sul sito, il risultato è che non succede proprio nulla.</p>
<p><strong>Fastweb ha mentito? Non direi</strong>. Diciamo che ha omesso tipo quelle due o tre informazioni utili a far funzionare il tutto. Nel momento in cui vi scrivo infatti è possibile usare un router alternativo al FASTGate, a patto di spendere qualche soldino e rispettare un po' di requisiti tecnici.</p>
<h2 id="requisiti">Requisiti</h2>
<p>Partiamo da quel poco che ci dice Fastweb, ovvero che <em>"l'apparato [...] deve essere collegato alla terminazione ottica (ONT) [...] con un cavo di rete [...] alla porta WAN"</em>.</p>
<p>L'ONT fornita da Fastweb è quella piccola terminazione di metallo che collega il cavo in fibra ottica direttamente al router.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/IMG_20190403_224147.resized.jpg" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/IMG_20190403_224147.resized-xs.jpg 300w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_224147.resized-sm.jpg 480w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_224147.resized-md.jpg 768w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_224147.resized-lg.jpg 1024w"></figure></figure>
<p>Questo piccolo stick è un trasmettitore che invia e riceve segnali luminosi sulla fibra ottica e li trasforma in impulsi elettrici, interpretabili dal router. L'ONT va collegato alla porta WAN del router con un cavo di rete, quindi... serve un <strong>convertitore</strong>!</p>
<h3 id="tp-link-mediaconverter-mc220l">TP-Link MediaConverter MC220L</h3>
<p>L'MC220L di TP-Link è attualmente il miglior MediaConverter che potete acquistare per questo caso d'uso. Il costo è inferiore ai 30 euro.</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/image-1.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/image-1-xs.png 300w ,https://gabriele.tips/media/posts/9/responsive/image-1-sm.png 480w ,https://gabriele.tips/media/posts/9/responsive/image-1-md.png 768w ,https://gabriele.tips/media/posts/9/responsive/image-1-lg.png 1024w"></figure>
<figcaption>TP-Link MediaConverter MC220L</figcaption>
</figure>
<p>È un dispositivo abbastanza stupido nel suo funzionamento. Ha due porte: in una ci mettete la ONT di Fastweb, nell'altra ci mettete il cavo di rete che va al vostro router. Fine. Non ha setup, non ha IP, non ha pagine di configurazioni.</p>
<p>Secondo Fastweb, dovrebbe essere finita qui (lol). In pratica, manca un enorme dettaglio, ovvero quali parametri inserire nella porta WAN del router che andremo ad usare.</p>
<h3 id="scelta-del-router-">Scelta del router...</h3>
<p>Se state già pensando di usare il vostro Netgear di 10 anni fa o il TP-Link da 15 euro comprato al Black-Friday, scordatevelo! <strong>Il primo requisito</strong> del router da usare per sostituire il FASTGate è che sia <strong>performante</strong>, perché deve essere in grado di gestire un traffico NAT WAN-to-LAN di 1Gbps.</p>
<p>Ebbene sì, benvenuti nel magico mondo delle connessioni domestiche ultra-veloci, dove anche in casa servono router carrozzati e performanti per poter sfruttare tutta la banda offerta dal provider.</p>
<p>Se volete sapere a grandi linee le performance del router che avete o che volete acquistare, potete fare riferimento a questa tabella comparativa di SmallNetBuilder:</p>
<p><a href="https://www.smallnetbuilder.com/tools/charts/router/bar/179-wan-to-lan-tcp/35">https://www.smallnetbuilder.com/tools/charts/router/bar/179-wan-to-lan-tcp/35</a></p>
<p>Questo però non è l'unico requisito che il router deve rispettare. Ce n'è un altro, che è fondamentale.</p>
<h3 id="-con-supporto-dhcp-option-60-sulla-wan">...con supporto dhcp option 60 sulla WAN</h3>
<p>Per sostituire il FASTGate con un router qualsiasi e far sì che funzioni, quest'ultimo deve "annunciarsi" come se fosse il FASTGate. Per fare questa cosa, occorre impostare alcuni <strong>parametri personalizzati</strong> nel dhcp-client della WAN, ovvero il servizio che richiede l'IP al provider in fase di connessione.</p>
<p>Nello specifico il parametro da configurare è l'Option 60 <code>vendor-class-identifier</code> del dhcp.</p>
<p>Ecco, questa non è una cosa proprio diffusa. È difficile trovare dei router ad uso consumer con questa opzione configurabile. In genere tutto ciò che è basato su OpenWRT e similari e/o ha una CLI, ha la possibilità di abilitare questo parametro. Non vorrei dirvi una stupidata ma gli ultimissimi Netgear consumer di fascia alta (300+ euro) dovrebbero supportare questi parametri, ma non fidatevi di me. Verificate.<br>In genere queste opzioni sono facilmente configurabili su router SOHO/professionali tipo MikroTik, Ubiquiti EdgeRouter, tutto ciò che è basato su OpenWRT, pfSense, etc...</p>
<h3 id="recap-dei-requisiti">Recap dei requisiti</h3>
<p>Quindi, punto elenco rapido di quello che serve:</p>
<!--kg-card-begin: markdown-->
<ul>
<li>Un MediaConverter per collegare la ONT originale fornita da Fastweb</li>
<li>Un router performante...</li>
<li>...che supporti la dhcp option 60 (vendor class identifier) sulla WAN</li>
</ul>
<!--kg-card-end: markdown-->
<p>Detto ciò, vediamo nel concreto.</p>
<h2 id="tempo-di-spendere-soldi-e-collegare-due-cavi">Tempo di spendere soldi e collegare due cavi</h2>
<p>Per il mio setup ho scelto di riciclare un vecchio Ubiquiti EdgeRouter-Lite che avevo nel cassetto. Per mia fortuna è un router che supporta tutti i parametri che servono e grazie all'accelerazione hardware riesce tranquillamente a gestire un throughput di 1 Gbps. Non ha il WiFi, ma per quello avevo già intenzione di prendermi un UniFi nanoHD, che per l'occasione ho acquistato insieme al MediaConverter.</p>
<figure class="kg-card kg-gallery-card kg-width-wide">
<div class="kg-gallery-container">
<div class="kg-gallery-row">
<div class="kg-gallery-image"><img src="https://gabriele.tips/media/posts/9/MVIMG_20190329_132819.resized.jpg" alt="" width="576" height="768" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/MVIMG_20190329_132819.resized-xs.jpg 300w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190329_132819.resized-sm.jpg 480w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190329_132819.resized-md.jpg 768w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190329_132819.resized-lg.jpg 1024w"></div>
<div class="kg-gallery-image"><img src="https://gabriele.tips/media/posts/9/MVIMG_20190329_132649.resized.jpg" alt="" width="576" height="768" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/MVIMG_20190329_132649.resized-xs.jpg 300w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190329_132649.resized-sm.jpg 480w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190329_132649.resized-md.jpg 768w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190329_132649.resized-lg.jpg 1024w"></div>
</div>
</div>
</figure>
<h3 id="colleghiamo-i-cavi">Colleghiamo i cavi</h3>
<p>Iniziamo quindi a <strong>sfilare l'ONT dal FASTGate</strong>. Prima di procedere con questa operazione, vi consiglio di spegnere il router e lasciarlo spento per qualche minuto. L'ONT infatti si <strong>surriscalda molto</strong> e c'è il rischio di scottarsi durante le operazioni.</p>
<p>Ricollegate quindi il tutto nel MediaConverter. Prima di collegare il cavo di rete al router però, dobbiamo configurare i parametri sulla WAN.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/IMG_20190403_000923.resized.jpg" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/IMG_20190403_000923.resized-xs.jpg 300w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_000923.resized-sm.jpg 480w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_000923.resized-md.jpg 768w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_000923.resized-lg.jpg 1024w"></figure></figure>
<h3 id="impostare-i-parametri-sulla-wan-del-router">Impostare i parametri sulla WAN del router</h3>
<p><strong>La prima cosa da fare</strong> è impostare l'interfaccia in modalità DHCP, in modo da prendersi automaticamente l'IP dal provider in fase di connessione. Questo è un setup praticamente standard che hanno tutti i router.</p>
<p><strong>La seconda cosa da fare</strong> è clonare il MAC address del FASTGate. Il MAC Address è scritto sulla destra di un'etichetta dietro il FASTGate.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/MVIMG_20190403_203840.resized.jpg" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/MVIMG_20190403_203840.resized-xs.jpg 300w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190403_203840.resized-sm.jpg 480w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190403_203840.resized-md.jpg 768w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190403_203840.resized-lg.jpg 1024w"></figure></figure>
<p>Per impostare il MAC sulla WAN nel EdgeRouter è possibile farlo da CLI, oppure andando nella tab Config Tree dell'interfaccia web e navigare fino a <code>interfaces / ethernet / eth0</code>, inserendo poi il MAC nell'apposito campo, facendo attenzione ad inserirlo nel formato <code>00:00:00:00:00:00</code>.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/Schermata-da-2019-04-03-20-50-46_450112b1995490a1e086956374eb0845.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-20-50-46_450112b1995490a1e086956374eb0845-xs.png 300w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-20-50-46_450112b1995490a1e086956374eb0845-sm.png 480w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-20-50-46_450112b1995490a1e086956374eb0845-md.png 768w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-20-50-46_450112b1995490a1e086956374eb0845-lg.png 1024w"></figure></figure>
<p>Confermate la configurazione con <code>Preview</code> e <code>Apply</code>.</p>
<p><strong>La terza cosa da fare</strong> è impostare il parametro DHCP Option 60. Per impostarlo possiamo sempre andare da CLI, oppure anche qui possiamo modificare le proprietà dal <strong>Config Tree</strong>. Navighiamo fino a <code>interfaces / ethernet / eth0 / dhcp-options</code> e nel campo <strong>client-option</strong> dobbiamo inserire questa stringa esatta:</p>
<p><code>send vendor-class-identifier "askey_HW_ES1_SW_0.00.67/dslforum.org";</code></p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/Schermata-da-2019-04-03-20-56-57_2e6aafa7f4b30c73220b551db0b42e5a.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-20-56-57_2e6aafa7f4b30c73220b551db0b42e5a-xs.png 300w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-20-56-57_2e6aafa7f4b30c73220b551db0b42e5a-sm.png 480w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-20-56-57_2e6aafa7f4b30c73220b551db0b42e5a-md.png 768w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-20-56-57_2e6aafa7f4b30c73220b551db0b42e5a-lg.png 1024w"></figure></figure>
<p>Confermate sempre con <code>Preview</code> e <code>Apply</code>.</p>
<p><strong>NOTA IMPORTANTE</strong>: la stringa esatta da inserire dovrebbe essere <code>send vendor-class-identifier "askey_HW_ES1_SW_0.00.67/dslforum.org";</code> tuttavia l'EdgeRouter restituisce un errore se si usano gli " nella stringa, quindi li ho sostituiti con <code>"</code>.</p>
<p>A questo punto, dovrebbe essere tutto pronto.</p>
<h3 id="test-drive">Test Drive</h3>
<p>Colleghiamo il cavo di rete alla porta WAN del nostro router.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/IMG_20190403_001118.resized.jpg" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/IMG_20190403_001118.resized-xs.jpg 300w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_001118.resized-sm.jpg 480w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_001118.resized-md.jpg 768w ,https://gabriele.tips/media/posts/9/responsive/IMG_20190403_001118.resized-lg.jpg 1024w"></figure></figure>
<p>I LED sul MediaConverter dovrebbero accendersi e nel giro di qualche secondo il router dovrebbe effettuare la connessione.</p>
<figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/Schermata-da-2019-03-31-16-02-01.resized.jpg" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-03-31-16-02-01.resized-xs.jpg 300w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-03-31-16-02-01.resized-sm.jpg 480w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-03-31-16-02-01.resized-md.jpg 768w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-03-31-16-02-01.resized-lg.jpg 1024w"></figure>
<figcaption>Connected! Velocità di download molto vicina alla nominale da contratto.</figcaption>
</figure>
<p>Fate un test di navigazione e se avete fatto tutto correttamente dovrebbe funzionare tutto!</p>
<p>A questo punto potete prendere il vostro FASTGate e fargli fare la fine che merita...</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/9/MVIMG_20190331_180053.resized.jpg" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/MVIMG_20190331_180053.resized-xs.jpg 300w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190331_180053.resized-sm.jpg 480w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190331_180053.resized-md.jpg 768w ,https://gabriele.tips/media/posts/9/responsive/MVIMG_20190331_180053.resized-lg.jpg 1024w"></figure></figure>
<h2 id="conclusioni">Conclusioni</h2>
<p>Come avete visto, sostituire il router fornito da Fastweb è possibile, tuttavia è un'operazione non alla portata di tutti. Richiede un hardware comunque al pari se non superiore al FASTGate (che tecnicamente schifo non fa) e un minimo di competenze tecniche e di networking per destreggiarsi tra collegamenti di rete e stringhe strane.</p>
<p><strong>A questo punto però, a molti di voi verrà spontanea una domanda: perché sostituire il router del provider con un router di proprietà? Cosa si guadagna? Il FASTGate non va bene?</strong></p>
<p>Ebbene, non è tanto l'hardware il problema in questo caso, ma il software.</p>
<p>Il software che gestisce questi router infatti è sviluppato su misura dal provider stesso e generalmente è un'accozzaglia di codice scritto male e senza criterio. Come risultato si ottiene un firmware con poche funzioni, spesso basilari e quelle poche funzioni avanzate che ci sono hanno bug assurdi che ne compromettono il corretto funzionamento.  </p>
<p>Un esempio? Il famoso caso di Destiny e il router "scolapasta" di TIM: <a href="https://www.bungie.net/it/Forums/Post/242575705">https://www.bungie.net/it/Forums/Post/242575705</a></p>
<p><strong>A questo punto qualcuno dirà... vabbé ma io devo solo navigare sull'internetto, cosa me ne frega di tutto il resto? Non posso stare col mio bel router che collego e funziona?</strong></p>
<p>Sì, certamente, però qui entriamo nel secondo problema di questi router, a parer mio il più grave e che riguarda praticamente il 100% degli utenti: la sicurezza e la privacy.</p>
<p>Come sicuramente saprete, questi router dei provider sono famosi per essere <strong>telegestiti</strong>, ovvero il provider può tecnicamente entrare nel vostro router e apportare modifiche da remoto. Queste modifiche generalmente sono aggiornamenti firmware, e fin qui nulla di male, però non si limitano a questo: possono tecnicamente modificare il funzionamento del router, estrapolare informazioni e vedere quello che c'è all'interno della vostra rete domestica, vedere i vostri dispositivi, vedere se avete un iPhone, un Android, un Roomba, una telecamera, e così via.</p>
<p>Se si considera la rete locale come le quattro mura di casa, è come se il vostro fornitore del gas venisse a casa vostra a vedere cosa state cucinando sui fornelli tutte le sere. Non solo, volendo ha la possibilità di decidere arbitrariamente di regolarvi la potenza della fiamma. Non suona come una bella cosa, vero?</p>
<p><strong>Però anche qui, sono quasi certo che qualcuno dirà "è il mio provider, sono consapevole e non ho nulla da nascondere. Mi fido!".</strong></p>
<p>Ebbene, durante questa fase di setup del nuovo router mi sono accorto per puro caso che dal mio IP pubblico con il vecchio FASTGate risultava una <strong>porta aperta in ingresso</strong> da internet. (Premessa per i neofiti: a meno di configurazioni particolari e volute, le porte in ingresso da internet devono essere assolutamente <strong>chiuse</strong>!)</p>
<p>Verificando la configurazione del FASTGate non ho trovato alcuna traccia di una configurazione che citasse questa porta, né tanto meno che fosse aperta indiscriminatamente a tutti.</p>
<p>Al che mi è venuto un dubbio: se non fosse solo un mio problema?</p>
<p>Facendo una velocissima ricerca su <strong>Shodan</strong>, ho scoperto di non essere solo. Cercando infatti per questa porta e isolando la ricerca sul suolo italiano, di quasi 59.000 risultati, <strong>ben 44.000 sono di Fastweb</strong> con un nettissimo distacco dal secondo posto.</p>
<figure class="kg-card kg-gallery-card kg-width-wide">
<div class="kg-gallery-container">
<div class="kg-gallery-row">
<div class="kg-gallery-image"><img src="https://gabriele.tips/media/posts/9/Schermata-da-2019-04-03-22-10-17-1.png" srcset="https://gabriele.tips/content/images/size/w600/2019/04/Schermata-da-2019-04-03-22-10-17-1.png 600w, https://gabriele.tips/media/posts/9/Schermata-da-2019-04-03-22-10-17-1.png 692w" alt="" width="692" height="496" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-22-10-17-1-xs.png 300w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-22-10-17-1-sm.png 480w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-22-10-17-1-md.png 768w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-22-10-17-1-lg.png 1024w"></div>
<div class="kg-gallery-image"><img src="https://gabriele.tips/media/posts/9/Schermata-da-2019-04-03-22-10-39_2c33668b1461ab69de2885337110f5e9-2.png" srcset="https://gabriele.tips/content/images/size/w600/2019/04/Schermata-da-2019-04-03-22-10-39_2c33668b1461ab69de2885337110f5e9-2.png 600w, https://gabriele.tips/media/posts/9/Schermata-da-2019-04-03-22-10-39_2c33668b1461ab69de2885337110f5e9-2.png 686w" alt="" width="686" height="280" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-22-10-39_2c33668b1461ab69de2885337110f5e9-2-xs.png 300w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-22-10-39_2c33668b1461ab69de2885337110f5e9-2-sm.png 480w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-22-10-39_2c33668b1461ab69de2885337110f5e9-2-md.png 768w ,https://gabriele.tips/media/posts/9/responsive/Schermata-da-2019-04-03-22-10-39_2c33668b1461ab69de2885337110f5e9-2-lg.png 1024w"></div>
</div>
</div>
</figure>
<p>Abbiamo quindi una situazione dove il router telegestito e controllato dal provider espone su internet un servizio del router non chiaramente identificato, aperto a tutti, in modo assolutamente silente, lasciando quindi il cliente ignaro della situazione di potenziale pericolo.</p>
<p>Il rischio, seppur remoto, è che qualcuno possa tentare di sfruttare delle potenziali vulnerabilità del servizio esposto, prendendo così il controllo dell'apparato e accedere così all'interno della vostra rete. Se mettiamo insieme anche il fatto che spesso il firmware di questi router è scritto coi piedi, il rischio di subire una violazione non sembra poi così remoto.</p>
<p>Ed ecco quindi che il provider, di cui vi fidate, può commettere degli errori e mettere in pericolo la vostra sicurezza e la vostra privacy.</p>
<p>Quindi, tornando alla domanda originale, perché sostituire il router del provider con un router proprietario?</p>
<p>La risposta è molto semplice:</p>
<p><strong>PRIVACY.</strong></p>
<p><strong>SICUREZZA.</strong></p>
<p><strong>LIBERTÀ.</strong></p>
            ]]>
        </content>
    </entry>
    <entry>
        <title>Automatizzare la connessione VPN con Tasker per Android</title>
        <author>
            <name>Gabriele</name>
        </author>
        <link href="https://gabriele.tips/automatizzare-la-connessione-vpn-con-tasker-per-android/"/>
        <id>https://gabriele.tips/automatizzare-la-connessione-vpn-con-tasker-per-android/</id>

        <updated>2018-11-25T18:19:34+01:00</updated>
            <summary>
                <![CDATA[
                    Da quando ho iniziato ad usare le VPN sul telefono mi sono accorto di un problema di semplice natura: ricordarmi di attivarla quando esco di&hellip;
                ]]>
            </summary>
        <content type="html">
            <![CDATA[
                <p>Da quando ho iniziato ad usare le VPN sul telefono mi sono accorto di un problema di semplice natura: ricordarmi di attivarla quando esco di casa. Spesse volte mi è capitato infatti di ricordarmene solo dopo qualche ora passata fuori casa, o ancora peggio accorgermi della mancanza di un filtro sulla navigazione quando ormai avevo già vinto 4 iPad e 9 iPhone X.</p>
<p>L'idea mi è quindi balzata in testa: perché non automatizzare la connessione VPN appena mi allontano dal WiFi di casa? Viceversa, appena torno a casa la VPN si deve disconnettere.</p>
<p>Ebbene, grazie a Tasker e il client OpenVPN for Android è possibile farlo!</p>
<p>Questa breve guida fa seguito alla mia guida iniziale su <a href="https://gabriele.tips/virtual-private-pi-holed-network/">come realizzare una VPN domestica con Pi-Hole integrato</a> da poter utilizzare fuori casa per navigare sicuri e protetti in mobilità.</p>
<h2 id="tasker-per-android">Tasker per Android</h2>
<p>Tasker è un'app per Android che permette di eseguire delle automazioni in base a determinate condizioni. La trovate nel <a href="https://play.google.com/store/apps/details?id=net.dinglisch.android.taskerm">Play Store</a> ad un costo di 2.99 €.</p>
<p>Il principio di funzionamento di Tasker è molto semplice:</p>
<p><strong>SE</strong> [CONDIZIONE DA RISPETTARE] <strong>È VERO, ALLORA</strong> [ESEGUI ATTIVITÀ]</p>
<p>In Tasker le "condizioni da rispettare" si chiamano <strong>Profili</strong>. Ogni <strong>Attività</strong> può contenere una o più <strong>Azioni</strong>.</p>
<h2 id="automatic-virtual-private-pi-holed-network">AUTOMATIC Virtual Private Pi-Holed Network</h2>
<p>La logica con cui ho creato l'automazione è la seguente:</p>
<ul>
<li><strong>SE</strong> [WiFi non connesso] <strong>È VERO, ALLORA</strong> [Connetti VPN]</li>
<li><strong>SE</strong> [WiFi di casa connesso] <strong>È VERO, ALLORA</strong> [Disconnetti VPN]</li>
</ul>
<p>La realizzazione è abbastanza semplice, vediamola insieme.</p>
<h2 id="creiamo-le-attivit-start-vpn-e-stop-vpn">Creiamo le attività "Start VPN" e "Stop VPN"</h2>
<p>Iniziamo con la creazione delle due attività di connessione e disconnessione della VPN.</p>
<h3 id="start-vpn">Start VPN</h3>
<p>Apriamo Tasker e posizioniamoci sulla tab <strong>Attività</strong>, dopodiché premiamo <strong>+</strong>, scriviamo <strong>"Start VPN"</strong> e poi confermiamo.</p>
<p>A questo punto possiamo andare ad inserire una o più azioni che verranno eseguite quando verrà avviata questa attività, noi dobbiamo connettere il nostro profilo VPN salvato in OpenVPN for Android.</p>
<p>Per farlo, premiamo <strong>+</strong> e scegliamo <strong>Sistema</strong> e <strong>Invia Intent</strong>. Vi apparirà un form dove bisogna inserire dei valori. I valori da inserire sono questi:</p>
<p>Azione<br><code>android.intent.action.MAIN<br></code>Cat <br><code>None<br></code>Extra (dove "Casa" è il nome del vostro profilo VPN) <br><code>de.blinkt.openvpn.shortcutProfileName: Casa<br></code>Pacchetto <br><code>de.blinkt.openvpn<br></code>Classe<br><code>de.blinkt.openvpn.LauchVPN<br></code>Target<br><code>Activity</code></p>
<p>Ora torniamo indietro fino al pannello principale delle attività.</p>
<h3 id="stop-vpn">Stop VPN</h3>
<p>Creiamo la seconda attività per disconnettere la VPN sempre seguendo la stessa procedura con <strong>+</strong>, scriviamo <strong>"Stop VPN"</strong> e confermiamo.</p>
<p>Di nuovo qui facciamo <strong>+</strong>, <strong>Sistema</strong>, <strong>Invia Intent</strong> e scriviamo questi parametri:</p>
<p>Azione<br><code>android.intent.action.MAIN<br></code>Cat <br><code>None<br></code>Extra (dove "Casa" è il nome del vostro profilo VPN) <br><code>de.blinkt.openvpn.shortcutProfileName: Casa<br></code>Pacchetto <br><code>de.blinkt.openvpn<br></code>Classe<br><code>de.blinkt.openvpn.api.DisconnectVPN<br></code>Target<br><code>Activity</code></p>
<p>Torniamo di nuovo indietro alla home e se avete fatto tutto giusto, dovreste ritrovarvi con due Attività: <strong>"Start VPN"</strong> e <strong>"Stop VPN"</strong>.</p>
<h2 id="creazione-dei-profili-wifi-collegato-e-non-wifi-collegato">Creazione dei profili "WIFI Collegato" e "Non WIFI Collegato"</h2>
<p>Ora possiamo passare alla creazione dei profili.</p>
<h3 id="wifi-collegato">WIFI Collegato</h3>
<p>Iniziamo con la creazione del profilo <strong>"WIFI Collegato"</strong>, dobbiamo quindi dirgli di disconnettere la VPN se siamo connessi al nostro WiFi di casa.</p>
<p>Spostiamoci nella tab <strong>Profili</strong>, premiamo <strong>+</strong>, selezioniamo <strong>Stato</strong> dal menu a scomparsa, poi <strong>Rete</strong> e <strong>WIFI Collegato</strong>.</p>
<p>Nel form che vi compare, dovete semplicemente inserire il <strong>nome della vostra rete WiFi</strong> nel campo <strong>SSID</strong> e lasciare tutto il resto invariato. Ora premendo indietro per tornare alla pagina principale vi comparirà automaticamente un menu rapido dal quale possiamo scegliere l'azione da eseguire quando si attiverà questo profilo. In questo specifico caso dovete selezionare <strong>"Stop VPN"</strong>.</p>
<p>Ed ecco quindi che abbiamo creato il primo profilo:</p>
<p><strong>SE</strong> [WiFi di casa connesso] <strong>È VERO, ALLORA</strong> [Disconnetti VPN]</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/8/Screenshot_20181125-161151-2.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-161151-2-xs.png 300w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-161151-2-sm.png 480w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-161151-2-md.png 768w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-161151-2-lg.png 1024w"></figure></figure>
<h3 id="non-wifi-collegato">Non WIFI Collegato</h3>
<p>Passiamo quindi alla creazione del profilo <strong>"Non WIFI Collegato"</strong>. Dobbiamo dire che se il WiFi viene scollegato, deve connettersi automaticamente la VPN.</p>
<p>Procediamo quindi allo stesso modo nella tab <strong>Profili</strong>, premiamo <strong>+</strong>, selezioniamo <strong>Stato</strong> dal menu a scomparsa, poi <strong>Rete</strong> e <strong>WIFI Collegato</strong>. A questo punto dobbiamo semplicemente mettere la spunta su <strong>Inverti</strong> lasciando tutto vuoto.</p>
<p>Torniamo indietro e ci verrà riproposto lo stesso menu rapido di prima, dove selezioniamo <strong>"Start VPN"</strong>.</p>
<p>Facendo così, abbiamo creato anche il nostro secondo profilo:</p>
<p><strong>SE</strong> [WiFi non connesso] <strong>È VERO, ALLORA</strong> [Connetti VPN]</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/8/Screenshot_20181125-161157-2.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-161157-2-xs.png 300w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-161157-2-sm.png 480w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-161157-2-md.png 768w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-161157-2-lg.png 1024w"></figure></figure>
<h2 id="salvataggio-della-configurazione">Salvataggio della configurazione</h2>
<p>Ora che abbiamo creato le azioni e i profili, non resta che salvare tutta la configurazione. Per farlo è sufficiente premere il <strong>check</strong> sulla barra del titolo e Tasker si attiverà.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/8/Screenshot_20181125-162303.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-162303-xs.png 300w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-162303-sm.png 480w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-162303-md.png 768w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-162303-lg.png 1024w"></figure></figure>
<h2 id="autorizzare-tasker-per-l-interazione-con-openvpn">Autorizzare Tasker per l'interazione con OpenVPN</h2>
<p>Alla prima esecuzione di un'attività potrebbe apparirvi un popup di richiesta autorizzazione. Questo è un avviso di sicurezza di <strong>OpenVPN per Android</strong> per indicarvi che un'applicazione di terze parti vuole interagire con i profili VPN. Qui dovete semplicemente <strong>mettere la spunta</strong> per considerare Tasker attendibile e fare <strong>Ok</strong>.</p>
<figure class="kg-card kg-image-card"><figure class="kg-image"><img  src="https://gabriele.tips/media/posts/8/Screenshot_20181125-170252-2.png" alt="" loading="lazy" sizes="(min-width: 920px) 703px, (min-width: 700px) calc(82vw - 35px), calc(100vw - 81px)" srcset="https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-170252-2-xs.png 300w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-170252-2-sm.png 480w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-170252-2-md.png 768w ,https://gabriele.tips/media/posts/8/responsive/Screenshot_20181125-170252-2-lg.png 1024w"></figure></figure>
<h2 id="considerazioni-finali">Considerazioni finali</h2>
<p>Sto utilizzando questa configurazione da circa un mesetto e posso confermarvi che il setup è abbastanza solido. So per certo però che i più attenti di voi non potranno fare a meno di notare che c'è un piccolo "bug" nella mia configurazione, che si presenta nella situazione in cui si passa dalla rete WiFi di casa direttamente ad un'altra rete WiFi. In questo specifico caso infatti il profilo "Non WIFI Collegato" non entra in azione, poiché il dispositivo migra direttamente da una rete WiFi ad un'altra, non scatenando l'evento che fa switchare il profilo.</p>
<p>La situazione potrebbe sembrare di facile risoluzione semplicemente inserendo il nome dell'SSID di casa insieme al parametro Inverti (SE ![SSID di Casa]), tuttavia impostando così il profilo ho riscontrato che viene attivato erroneamente nel momento in cui il telefono si connette in VPN, generando così un loop di connessione e disconnessione continua.</p>
<p>Ammetto di non avere indagato a fondo, tuttavia il setup così impostato è perfetto per la mia esperienza d'uso, ovvero:</p>
<p><strong>Sono a casa -&gt;</strong> Profilo "WiFi Collegato", navigo in rete locale.</p>
<p><strong>Fuori casa in 4G -&gt;</strong> Mi sgancio dal wifi, si attiva "Non WiFi Collegato" e navigo in VPN.</p>
<p><strong>Mi collego ad altri WiFi -&gt;</strong> La condizione per "WiFi Collegato" non viene rispettata in quanto SSID differente, quindi continuo a navigare in VPN.</p>
<p><strong>Torno a casa -&gt;</strong> Rileva connessione al WiFi domestico, entra "WiFi Collegato" che disconnette la VPN.</p>
<p>E con questo è tutto. Se avete bisogno di ulteriori informazioni, segnalarmi degli errori o fornirmi feedback, scrivetemi! ☺️</p>
            ]]>
        </content>
    </entry>
</feed>

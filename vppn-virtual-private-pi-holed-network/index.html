<!DOCTYPE html><html lang="it"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>VPPN: Virtual Private &quot;Pi-Holed&quot; Network - Gabriele Tips</title><meta name="description" content="Chi mi conosce sa molto bene che provo un amore incondizionato per Pi-Hole. Navigare in una rete non protetta da Pi-Hole mi fa sentire nudo e vulnerabile, perché Pi-Hole non è un semplice ad-blocker, è un incredibile strumento per alzare in modo considerevole la sicurezza&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://gabriele.tips/vppn-virtual-private-pi-holed-network/"><link rel="alternate" type="application/atom+xml" href="https://gabriele.tips/feed.xml"><link rel="alternate" type="application/json" href="https://gabriele.tips/feed.json"><meta property="og:title" content="VPPN: Virtual Private 'Pi-Holed' Network"><meta property="og:site_name" content="Gabriele Tips"><meta property="og:description" content="Chi mi conosce sa molto bene che provo un amore incondizionato per Pi-Hole. Navigare in una rete non protetta da Pi-Hole mi fa sentire nudo e vulnerabile, perché Pi-Hole non è un semplice ad-blocker, è un incredibile strumento per alzare in modo considerevole la sicurezza&hellip;"><meta property="og:url" content="https://gabriele.tips/vppn-virtual-private-pi-holed-network/"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://gabriele.tips/media/website/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="https://gabriele.tips/assets/css/style.css?v=a11c41b352f34dfa4bc630cdc7e06e55"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://gabriele.tips/vppn-virtual-private-pi-holed-network/"},"headline":"VPPN: Virtual Private \"Pi-Holed\" Network","datePublished":"2018-11-02T17:34","dateModified":"2023-08-05T18:07","description":"Chi mi conosce sa molto bene che provo un amore incondizionato per Pi-Hole. Navigare in una rete non protetta da Pi-Hole mi fa sentire nudo e vulnerabile, perché Pi-Hole non è un semplice ad-blocker, è un incredibile strumento per alzare in modo considerevole la sicurezza&hellip;","author":{"@type":"Person","name":"Gabriele","url":"https://gabriele.tips/authors/gabriele/"},"publisher":{"@type":"Organization","name":"Gabriele"}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://gabriele.tips/">Gabriele Tips</a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://gabriele.tips/privacy-policy/" target="_self">privacy policy</a></li><li><a href="https://gabriele.tips/whoami/" target="_self">whoami</a></li></ul></nav></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2018-11-02T17:34">2 novembre 2018</time></div><h1>VPPN: Virtual Private &quot;Pi-Holed&quot; Network</h1></div></header></div><div class="wrapper post__entry"><p>Chi mi conosce sa molto bene che provo un amore incondizionato per <a href="https://pi-hole.net/">Pi-Hole</a>. Navigare in una rete non protetta da Pi-Hole mi fa sentire nudo e vulnerabile, perché Pi-Hole non è un semplice ad-blocker, è un incredibile strumento per alzare in modo considerevole la sicurezza della navigazione.</p><p>Senza gli ads, si riduce quasi del 100% la possibilità di venire dirottati su qualche pagina malevola a causa di malvertising.</p><p>Per esempio, attacchi di questo tipo verrebbero completamente neutralizzati grazie a Pi-Hole:</p><figure class="post__image"><a href="https://twitter.com/GabrielLandau/status/1055300918101598208" target="_blank" rel="noopener noreferrer"><img loading="lazy" src="https://gabriele.tips/media/posts/7/Screenshot-2023-08-05-alle-18.05.05.png" alt="" width="1178" height="1028" sizes="100vw" srcset="https://gabriele.tips/media/posts/7/responsive/Screenshot-2023-08-05-alle-18.05.05-xs.png 300w, https://gabriele.tips/media/posts/7/responsive/Screenshot-2023-08-05-alle-18.05.05-sm.png 480w, https://gabriele.tips/media/posts/7/responsive/Screenshot-2023-08-05-alle-18.05.05-md.png 768w, https://gabriele.tips/media/posts/7/responsive/Screenshot-2023-08-05-alle-18.05.05-lg.png 1024w, https://gabriele.tips/media/posts/7/responsive/Screenshot-2023-08-05-alle-18.05.05-xl.png 1360w, https://gabriele.tips/media/posts/7/responsive/Screenshot-2023-08-05-alle-18.05.05-2xl.png 1600w"></a></figure><p></p><p>Fin dai primi giorni di utilizzo ho desiderato poter avere lo stesso livello di protezione anche in mobilità con lo smartphone. L'idea era quella di fare una VPN per dirottare tutto il traffico di navigazione nella rete di casa e far gestire quindi i DNS da Pi-Hole. Purtroppo questa idea è durata qualche secondo, giusto il tempo di ricordarsi di avere una misera aDSL da 8Mbps/700Kbps. #FuckDigitalDivide<br>Non potendo fare una VPN domestica a causa delle scarse prestazioni della mia rete, ho adottato per diverso tempo una VPN di terze parti, nello specifico F-Secure Freedome, che implementa un filtro per siti malevoli e tracking. Non siamo ai livelli di Pi-Hole, però mi ha aiutato a navigare in modo sicuro anche in mobilità negli ultimi due anni.</p><p>Ora però la musica è cambiata. Ora ho cambiato casa e ho finalmente a disposizione una connessione stratosferica, 1Gbps/200Mbps con OpenFiber!</p><figure class="kg-card kg-image-card"><figure class="kg-image"><img src="https://gabriele.tips/media/posts/7/asdasdasdasda.gif" alt="" loading="lazy"></figure></figure><p>Appena ho collegato il router e ho provato con mano l'incredibile velocità, l'idea della VPN è tornata a solleticarmi, così una sera mi sono messo comodo sul divano e ho realizzato la mia <strong>Virtual Private Pi-Holed Network</strong>!</p><p>Nota: esiste una <a href="https://docs.pi-hole.net/guides/vpn/overview/">guida ufficiale molto ben dettagliata</a>, da cui ho preso informazioni a piene mani, tuttavia parte da una Raspbian pulita senza nulla, ci installa prima OpenVPN e poi Pi-Hole. E' molto più facile invece trovarsi in una situazione dove si ha un RPi con Pi-Hole già installato e configurato e si desidera installarci sopra la VPN.</p><p>Ed è esattamente quello che faremo ora.</p><p>Situazione di partenza: Raspberry Pi nella rete locale con Raspbian Lite e Pi-Hole installato e funzionante. Darò per scontato che se siete arrivati qui, sapete connettervi in SSH al vostro RPi. Consiglio prima di partire con l'installazione, di fare un controllo su eventuali aggiornamenti disponibili:</p><pre><code>sudo apt update &amp;&amp; sudo apt upgrade</code></pre><h3 id="installiamo-openvpn-su-pi-hole">Installiamo OpenVPN su Pi-Hole</h3><p>La prima cosa da fare è scaricare e installare OpenVPN <a href="https://en.wikipedia.org/wiki/Road_warrior_(computing)">road warrior</a>. Connettetevi in SSH al RPi ed eseguite questo comando:</p><pre><code>wget https://git.io/vpn -O openvpn-install.shchmod 755 openvpn-install.shsudo ./openvpn-install.sh</code></pre><p>Verrà eseguita la procedura guidata per l'installazione. E' molto semplice e basta inserire poche informazioni chiave. Vi consiglio di tenere le stesse impostazioni che ho messo io e cambiare solamente il vostro indirizzo pubblico e il nome del client alla fine:</p><pre><code>Welcome to this quick OpenVPN "road warrior" installerI need to ask you a few questions before starting the setupYou can leave the default options and just press enter if you are ok with themFirst I need to know the IPv4 address of the network interface you want OpenVPNlistening to.IP address: 10.8.0.1This server is behind NAT. What is the public IPv4 address or hostname?Public IP address / hostname: x.x.x.x #Nota: qui dovete inserire il vostro IP pubblico di casaWhich protocol do you want for OpenVPN connections?   1) UDP (recommended)   2) TCPProtocol [1-2]: 1What port do you want OpenVPN listening to?Port: 1194Which DNS do you want to use with the VPN?   1) Current system resolvers   2) Google   3) OpenDNS   4) NTT   5) Hurricane Electric   6) VerisignDNS [1-6]: 1Finally, tell me your name for the client certificatePlease, use one word only, no special charactersClient name: GabrielePixel2 #Nota: qui dovete inserire un nome profilo per il vostro utente remotoOkay, that was all I needed. We are ready to setup your OpenVPN server nowPress any key to continue...</code></pre><p>A questo punto partirà l'installazione e terminerà così:</p><pre><code>Finished!Your client configuration is available at /root/GabrielePixel2.ovpnIf you want to add more clients, you simply need to run this script again!</code></pre><p>Il file che ha generato è il profilo <code>.ovpn</code> da copiare nel vostro client per poter effettuare la connessione. Di default lo salva in <code>/root/</code>, vi consiglio di spostarlo nella vostra home per poterlo prelevare dal RPi con più semplicità:</p><pre><code>cd ~sudo mv /root/GabrielePixel2.ovpn GabrielePixel2.ovpn</code></pre><p>A seconda della configurazione del vostro RPi, potrebbe essere necessario diventare proprietari del file per poterlo gestire. Se usate l'utente di default <code>pi</code> basta digitare:</p><pre><code>sudo chown pi:pi GabrielePixel2.ovpn</code></pre><p>Di questo file ci occuperemo più avanti. Procediamo con la configurazione del server VPN.</p><h3 id="configuriamo-openvpn-server">Configuriamo OpenVPN Server</h3><p>Ora dobbiamo cambiare i resolver DNS per l'interfaccia <code>tun0</code> creata dallo script di OpenVPN. Prima però ci serve sapere l'IP di questa interfaccia. Se non avete cambiato nulla in fase di installazione rispetto alla guida, dovrebbe avere indirizzo <code>10.8.0.1</code>, in alternativa potete sempre verificare con questi semplici comandi</p><p>Per Raspbian Jessie:</p><pre><code>ifconfig tun0 | grep 'inet addr'</code></pre><p>Per Raspbian Stretch:</p><pre><code>ip a</code></pre><p>Annotiamoci l'IP dell'interfaccia <code>tun0</code>, quindi andiamo a modificare il file di configurazione di OpenVPN:</p><pre><code>sudo nano /etc/openvpn/server.conf</code></pre><p>Cercate all'interno del file la riga che inizia con <code>push "dhcp option DNS x.x.x.x"</code>   e modificatela con l'IP della vostra <code>tun0</code>:</p><pre><code>push "dhcp-option DNS 10.8.0.1"</code></pre><p>Chiudete salvando il file e riavviate il servizio di OpenVPN:</p><pre><code>sudo service openvpn restart</code></pre><p>Ora colleghiamoci al pannello admin web di Pi-Hole, nelle impostazioni, sezione DNS, impostate l'interfaccia di ascolto su "Listen on all interfaces" e salvate:</p><figure class="kg-card kg-image-card kg-card-hascaption"><figure class="kg-image"><img src="https://gabriele.tips/media/posts/7/Screenshot_2018-11-02-Pi-hole-Admin-Console.png" alt="" loading="lazy" sizes="100vw" srcset="https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Pi-hole-Admin-Console-xs.png 300w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Pi-hole-Admin-Console-sm.png 480w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Pi-hole-Admin-Console-md.png 768w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Pi-hole-Admin-Console-lg.png 1024w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Pi-hole-Admin-Console-xl.png 1360w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Pi-hole-Admin-Console-2xl.png 1600w"></figure><figcaption>Listen on all interfaces</figcaption></figure><p>A questo punto il server OpenVPN è configurato e funzionante con Pi-Hole come resolver DNS! 👏</p><h3 id="port-forward-dal-router">Port Forward dal router</h3><p>Per poter accedere da fuori è necessario esporre su internet la porta 1194 UDP del vostro RPi. Non vi lascio una guida per farlo perché cambia a seconda del router che avete, però vi consiglio di fare molta attenzione ad esporre SOLAMENTE la porta 1194 UDP e non tutto il RPi. <strong>Non mettete il RPi in DMZ!!</strong></p><h3 id="esportiamo-il-file-ovpn">Esportiamo il file .ovpn</h3><p>Ora possiamo provare a connetterci alla nostra VPN, però prima dobbiamo recuperare il nostro file di configurazione <code>.ovpn</code> dal RPi e copiarlo sullo smartphone. Per farlo è sufficiente connettersi con un client SFTP e prelevare dalla home directory il file. Se siete su Windows vi consiglio <a href="https://winscp.net/eng/docs/lang:it">WinSCP</a>. Salvate pure il file <code>.ovpn</code> dove volete nel vostro smartphone, non è importante.</p><p>Se volete, potete creare ulteriori nuovi utenti semplicemente eseguendo di nuovo lo script iniziale</p><pre><code>sudo ./openvpn-install.sh</code></pre><p>Questa volta apparirà un menu differente, dove potremo creare un nuovo profilo <code>.ovpn</code> da usare per esempio su un altro device.</p><pre><code>Looks like OpenVPN is already installedWhat do you want to do?   1) Add a new user   2) Revoke an existing user   3) Remove OpenVPN   4) ExitSelect an option [1-4]: 1Tell me a name for the client certificatePlease, use one word only, no special charactersClient name: iPhone7</code></pre><p>La procedura per esportare il file .ovpn è la medesima riportata sopra.</p><h3 id="connettiamoci-alla-vpn">Connettiamoci alla VPN</h3><p>Procediamo quindi all'installazione del client OpenVPN. Su Android vi consiglio OpenVPN for Android, poiché è un'alternativa OpenSource al client ufficiale e permette una personalizzazione più granulare.</p><p>Ora dovete solamente importare il profilo <code>.ovpn</code> nell'app e provare a connettervi.</p><p>Nota: potete cambiare liberamente il nome della connessione. Per esempio io l'ho chiamata <code>Casa</code>.</p><figure class="kg-card kg-image-card"><figure class="kg-image"><img src="https://gabriele.tips/media/posts/7/Screenshot_20181102-153132.png" alt="" loading="lazy" sizes="100vw" srcset="https://gabriele.tips/media/posts/7/responsive/Screenshot_20181102-153132-xs.png 300w, https://gabriele.tips/media/posts/7/responsive/Screenshot_20181102-153132-sm.png 480w, https://gabriele.tips/media/posts/7/responsive/Screenshot_20181102-153132-md.png 768w, https://gabriele.tips/media/posts/7/responsive/Screenshot_20181102-153132-lg.png 1024w, https://gabriele.tips/media/posts/7/responsive/Screenshot_20181102-153132-xl.png 1360w, https://gabriele.tips/media/posts/7/responsive/Screenshot_20181102-153132-2xl.png 1600w"></figure></figure><p>Se tutto è stato fatto come da manuale, dovrebbe connettersi e dovreste riuscire a navigare.</p><figure class="kg-card kg-image-card"><figure class="kg-image"><img src="https://gabriele.tips/media/posts/7/Screenshot--2-nov-2018-17_30_49-.png" alt="" loading="lazy" sizes="100vw" srcset="https://gabriele.tips/media/posts/7/responsive/Screenshot--2-nov-2018-17_30_49--xs.png 300w, https://gabriele.tips/media/posts/7/responsive/Screenshot--2-nov-2018-17_30_49--sm.png 480w, https://gabriele.tips/media/posts/7/responsive/Screenshot--2-nov-2018-17_30_49--md.png 768w, https://gabriele.tips/media/posts/7/responsive/Screenshot--2-nov-2018-17_30_49--lg.png 1024w, https://gabriele.tips/media/posts/7/responsive/Screenshot--2-nov-2018-17_30_49--xl.png 1360w, https://gabriele.tips/media/posts/7/responsive/Screenshot--2-nov-2018-17_30_49--2xl.png 1600w"></figure></figure><p>Come prova dell'effettiva navigazione con Pi-Hole, potete provare a visitare questo sito: <a href="https://blockads.fivefilters.org/?pihole">https://blockads.fivefilters.org/?pihole</a></p><figure class="kg-card kg-image-card"><figure class="kg-image"><img src="https://gabriele.tips/media/posts/7/Screenshot_2018-11-02-Block-Ads--1.png" alt="" loading="lazy" sizes="100vw" srcset="https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Block-Ads--1-xs.png 300w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Block-Ads--1-sm.png 480w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Block-Ads--1-md.png 768w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Block-Ads--1-lg.png 1024w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Block-Ads--1-xl.png 1360w, https://gabriele.tips/media/posts/7/responsive/Screenshot_2018-11-02-Block-Ads--1-2xl.png 1600w"></figure></figure><p>Se vi restituisce questo messaggio, potete farvi i complimenti, avete appena creato la vostra <strong>Virtual Private Pi-Holed Network</strong>!</p><h3> </h3></div><footer class="wrapper post__footer"><div class="post__share"></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://gabriele.tips/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://gabriele.tips/perche-dazn-consiglia-edge-e-internet-explorer/" class="post__nav-link" rel="prev"><span>Previous</span> Perché DAZN consiglia Edge e Internet Explorer?</a></div><div class="post__nav-next"><a href="https://gabriele.tips/automatizzare-la-connessione-vpn-con-tasker-per-android/" class="post__nav-link" rel="next"><span>Next</span> Automatizzare la connessione VPN con Tasker per Android </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://gabriele.tips/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p style="color: white;">Gabriele Tips - Powered by Publii</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://gabriele.tips/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://gabriele.tips/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>